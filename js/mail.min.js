/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/**
 * ownCloud - Mail
 *
 * This file is licensed under the Affero General Public License version 3 or
 * later. See the COPYING file.
 *
 * @author Christoph Wurst <christoph@winzerhof-wurst.at>
 * @copyright Christoph Wurst 2015
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

// MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v2.4.5
//
// Copyright (c)2016 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://marionettejs.com

/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */

// Copyright (c)2016 Derick Bailey, Muted Solutions, LLC.

// Distributed under MIT license

/*!

 handlebars v4.0.5

Copyright (C) 2011-2015 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/

/**
 * ownCloud - Mail
 *
 * This file is licensed under the Affero General Public License version 3 or
 * later. See the COPYING file.
 *
 * @author Christoph Wurst <christoph@winzerhof-wurst.at>
 * @copyright Christoph Wurst 2016
 */

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * ownCloud - require('app')
 *
 * This file is licensed under the Affero General Public License version 3 or
 * later. See the COPYING file.
 *
 * @author Christoph Wurst <christoph@winzerhof-wurst.at>
 * @copyright Christoph Wurst 2016
 */

/**
 * ownCloud - Mail
 *
 * This file is licensed under the Affero General Public License version 3 or
 * later. See the COPYING file.
 *
 * @author Christoph Wurst <christoph@winzerhof-wurst.at>
 * @copyright Christoph Wurst 2015, 2016
 */

/**
 * ownCloud  Mail
 *
 * This file is licensed under the Affero General Public License version 3 or
 * later. See the COPYING file.
 *
 * @author Christoph Wurst <christoph@winzerhof-wurst.at>
 * @copyright Christoph Wurst 2015
 */

/**
 * @author Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * ownCloud - Mail
 *
 * This code is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License, version 3,
 * as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License, version 3,
 * along with this program.  If not, see <http://www.gnu.org/licenses/>
 *
 */

define("domready",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](l)}function t(){var t=u;c&&t.length&&(u=[],e(t))}function n(){c||(c=!0,a&&clearInterval(a),t())}function i(e){return c?e(l):u.push(e),i}var s,r,a,o="undefined"!=typeof window&&window.document,c=!o,l=o?document:null,u=[];if(o){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),r=document.createElement("div");try{s=null===window.frameElement}catch(h){}r.doScroll&&s&&window.external&&(a=setInterval(function(){try{r.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(e,t,n,s){s.isBuild?n(null):i(n)},i}),define("OC",[],function(){"use strict";return OC}),function(){function e(e){function t(t,n,i,s,r,a){for(;r>=0&&a>r;r+=e){var o=s?s[r]:r;i=n(i,t[o],o,t)}return i}return function(n,i,s,r){i=w(i,r,4);var a=!M(n)&&y.keys(n),o=(a||n).length,c=e>0?0:o-1;return arguments.length<3&&(s=n[a?a[c]:c],c+=e),t(n,i,s,a,c,o)}}function t(e){return function(t,n,i){n=b(n,i);for(var s=S(t),r=e>0?0:s-1;r>=0&&s>r;r+=e)if(n(t[r],r,t))return r;return-1}}function n(e,t,n){return function(i,s,r){var a=0,o=S(i);if("number"==typeof r)e>0?a=r>=0?r:Math.max(r+o,a):o=r>=0?Math.min(r+1,o):r+o+1;else if(n&&r&&o)return r=n(i,s),i[r]===s?r:-1;if(s!==s)return r=t(u.call(i,a,o),y.isNaN),r>=0?r+a:-1;for(r=e>0?a:o-1;r>=0&&o>r;r+=e)if(i[r]===s)return r;return-1}}function i(e,t){var n=A.length,i=e.constructor,s=y.isFunction(i)&&i.prototype||o,r="constructor";for(y.has(e,r)&&!y.contains(t,r)&&t.push(r);n--;)r=A[n],r in e&&e[r]!==s[r]&&!y.contains(t,r)&&t.push(r)}var s=this,r=s._,a=Array.prototype,o=Object.prototype,c=Function.prototype,l=a.push,u=a.slice,h=o.toString,d=o.hasOwnProperty,p=Array.isArray,f=Object.keys,m=c.bind,g=Object.create,v=function(){},y=function(e){return e instanceof y?e:this instanceof y?void(this._wrapped=e):new y(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):s._=y,y.VERSION="1.8.3";var w=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,s){return e.call(t,n,i,s)};case 4:return function(n,i,s,r){return e.call(t,n,i,s,r)}}return function(){return e.apply(t,arguments)}},b=function(e,t,n){return null==e?y.identity:y.isFunction(e)?w(e,t,n):y.isObject(e)?y.matcher(e):y.property(e)};y.iteratee=function(e,t){return b(e,t,1/0)};var _=function(e,t){return function(n){var i=arguments.length;if(2>i||null==n)return n;for(var s=1;i>s;s++)for(var r=arguments[s],a=e(r),o=a.length,c=0;o>c;c++){var l=a[c];t&&void 0!==n[l]||(n[l]=r[l])}return n}},x=function(e){if(!y.isObject(e))return{};if(g)return g(e);v.prototype=e;var t=new v;return v.prototype=null,t},k=function(e){return function(t){return null==t?void 0:t[e]}},C=Math.pow(2,53)-1,S=k("length"),M=function(e){var t=S(e);return"number"==typeof t&&t>=0&&C>=t};y.each=y.forEach=function(e,t,n){t=w(t,n);var i,s;if(M(e))for(i=0,s=e.length;s>i;i++)t(e[i],i,e);else{var r=y.keys(e);for(i=0,s=r.length;s>i;i++)t(e[r[i]],r[i],e)}return e},y.map=y.collect=function(e,t,n){t=b(t,n);for(var i=!M(e)&&y.keys(e),s=(i||e).length,r=Array(s),a=0;s>a;a++){var o=i?i[a]:a;r[a]=t(e[o],o,e)}return r},y.reduce=y.foldl=y.inject=e(1),y.reduceRight=y.foldr=e(-1),y.find=y.detect=function(e,t,n){var i;return i=M(e)?y.findIndex(e,t,n):y.findKey(e,t,n),void 0!==i&&-1!==i?e[i]:void 0},y.filter=y.select=function(e,t,n){var i=[];return t=b(t,n),y.each(e,function(e,n,s){t(e,n,s)&&i.push(e)}),i},y.reject=function(e,t,n){return y.filter(e,y.negate(b(t)),n)},y.every=y.all=function(e,t,n){t=b(t,n);for(var i=!M(e)&&y.keys(e),s=(i||e).length,r=0;s>r;r++){var a=i?i[r]:r;if(!t(e[a],a,e))return!1}return!0},y.some=y.any=function(e,t,n){t=b(t,n);for(var i=!M(e)&&y.keys(e),s=(i||e).length,r=0;s>r;r++){var a=i?i[r]:r;if(t(e[a],a,e))return!0}return!1},y.contains=y.includes=y.include=function(e,t,n,i){return M(e)||(e=y.values(e)),("number"!=typeof n||i)&&(n=0),y.indexOf(e,t,n)>=0},y.invoke=function(e,t){var n=u.call(arguments,2),i=y.isFunction(t);return y.map(e,function(e){var s=i?t:e[t];return null==s?s:s.apply(e,n)})},y.pluck=function(e,t){return y.map(e,y.property(t))},y.where=function(e,t){return y.filter(e,y.matcher(t))},y.findWhere=function(e,t){return y.find(e,y.matcher(t))},y.max=function(e,t,n){var i,s,r=-(1/0),a=-(1/0);if(null==t&&null!=e){e=M(e)?e:y.values(e);for(var o=0,c=e.length;c>o;o++)i=e[o],i>r&&(r=i)}else t=b(t,n),y.each(e,function(e,n,i){s=t(e,n,i),(s>a||s===-(1/0)&&r===-(1/0))&&(r=e,a=s)});return r},y.min=function(e,t,n){var i,s,r=1/0,a=1/0;if(null==t&&null!=e){e=M(e)?e:y.values(e);for(var o=0,c=e.length;c>o;o++)i=e[o],r>i&&(r=i)}else t=b(t,n),y.each(e,function(e,n,i){s=t(e,n,i),(a>s||s===1/0&&r===1/0)&&(r=e,a=s)});return r},y.shuffle=function(e){for(var t,n=M(e)?e:y.values(e),i=n.length,s=Array(i),r=0;i>r;r++)t=y.random(0,r),t!==r&&(s[r]=s[t]),s[t]=n[r];return s},y.sample=function(e,t,n){return null==t||n?(M(e)||(e=y.values(e)),e[y.random(e.length-1)]):y.shuffle(e).slice(0,Math.max(0,t))},y.sortBy=function(e,t,n){return t=b(t,n),y.pluck(y.map(e,function(e,n,i){return{value:e,index:n,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var E=function(e){return function(t,n,i){var s={};return n=b(n,i),y.each(t,function(i,r){var a=n(i,r,t);e(s,i,a)}),s}};y.groupBy=E(function(e,t,n){y.has(e,n)?e[n].push(t):e[n]=[t]}),y.indexBy=E(function(e,t,n){e[n]=t}),y.countBy=E(function(e,t,n){y.has(e,n)?e[n]++:e[n]=1}),y.toArray=function(e){return e?y.isArray(e)?u.call(e):M(e)?y.map(e,y.identity):y.values(e):[]},y.size=function(e){return null==e?0:M(e)?e.length:y.keys(e).length},y.partition=function(e,t,n){t=b(t,n);var i=[],s=[];return y.each(e,function(e,n,r){(t(e,n,r)?i:s).push(e)}),[i,s]},y.first=y.head=y.take=function(e,t,n){return null!=e?null==t||n?e[0]:y.initial(e,e.length-t):void 0},y.initial=function(e,t,n){return u.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},y.last=function(e,t,n){return null!=e?null==t||n?e[e.length-1]:y.rest(e,Math.max(0,e.length-t)):void 0},y.rest=y.tail=y.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},y.compact=function(e){return y.filter(e,y.identity)};var I=function(e,t,n,i){for(var s=[],r=0,a=i||0,o=S(e);o>a;a++){var c=e[a];if(M(c)&&(y.isArray(c)||y.isArguments(c))){t||(c=I(c,t,n));var l=0,u=c.length;for(s.length+=u;u>l;)s[r++]=c[l++]}else n||(s[r++]=c)}return s};y.flatten=function(e,t){return I(e,t,!1)},y.without=function(e){return y.difference(e,u.call(arguments,1))},y.uniq=y.unique=function(e,t,n,i){y.isBoolean(t)||(i=n,n=t,t=!1),null!=n&&(n=b(n,i));for(var s=[],r=[],a=0,o=S(e);o>a;a++){var c=e[a],l=n?n(c,a,e):c;t?(a&&r===l||s.push(c),r=l):n?y.contains(r,l)||(r.push(l),s.push(c)):y.contains(s,c)||s.push(c)}return s},y.union=function(){return y.uniq(I(arguments,!0,!0))},y.intersection=function(e){for(var t=[],n=arguments.length,i=0,s=S(e);s>i;i++){var r=e[i];if(!y.contains(t,r)){for(var a=1;n>a&&y.contains(arguments[a],r);a++);a===n&&t.push(r)}}return t},y.difference=function(e){var t=I(arguments,!0,!0,1);return y.filter(e,function(e){return!y.contains(t,e)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(e){for(var t=e&&y.max(e,S).length||0,n=Array(t),i=0;t>i;i++)n[i]=y.pluck(e,i);return n},y.object=function(e,t){for(var n={},i=0,s=S(e);s>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},y.findIndex=t(1),y.findLastIndex=t(-1),y.sortedIndex=function(e,t,n,i){n=b(n,i,1);for(var s=n(t),r=0,a=S(e);a>r;){var o=Math.floor((r+a)/2);n(e[o])<s?r=o+1:a=o}return r},y.indexOf=n(1,y.findIndex,y.sortedIndex),y.lastIndexOf=n(-1,y.findLastIndex),y.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var i=Math.max(Math.ceil((t-e)/n),0),s=Array(i),r=0;i>r;r++,e+=n)s[r]=e;return s};var P=function(e,t,n,i,s){if(!(i instanceof t))return e.apply(n,s);var r=x(e.prototype),a=e.apply(r,s);return y.isObject(a)?a:r};y.bind=function(e,t){if(m&&e.bind===m)return m.apply(e,u.call(arguments,1));if(!y.isFunction(e))throw new TypeError("Bind must be called on a function");var n=u.call(arguments,2),i=function(){return P(e,i,t,this,n.concat(u.call(arguments)))};return i},y.partial=function(e){var t=u.call(arguments,1),n=function(){for(var i=0,s=t.length,r=Array(s),a=0;s>a;a++)r[a]=t[a]===y?arguments[i++]:t[a];for(;i<arguments.length;)r.push(arguments[i++]);return P(e,n,this,this,r)};return n},y.bindAll=function(e){var t,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(t=1;i>t;t++)n=arguments[t],e[n]=y.bind(e[n],e);return e},y.memoize=function(e,t){var n=function(i){var s=n.cache,r=""+(t?t.apply(this,arguments):i);return y.has(s,r)||(s[r]=e.apply(this,arguments)),s[r]};return n.cache={},n},y.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},y.defer=y.partial(y.delay,y,1),y.throttle=function(e,t,n){var i,s,r,a=null,o=0;n||(n={});var c=function(){o=n.leading===!1?0:y.now(),a=null,r=e.apply(i,s),a||(i=s=null)};return function(){var l=y.now();o||n.leading!==!1||(o=l);var u=t-(l-o);return i=this,s=arguments,0>=u||u>t?(a&&(clearTimeout(a),a=null),o=l,r=e.apply(i,s),a||(i=s=null)):a||n.trailing===!1||(a=setTimeout(c,u)),r}},y.debounce=function(e,t,n){var i,s,r,a,o,c=function(){var l=y.now()-a;t>l&&l>=0?i=setTimeout(c,t-l):(i=null,n||(o=e.apply(r,s),i||(r=s=null)))};return function(){r=this,s=arguments,a=y.now();var l=n&&!i;return i||(i=setTimeout(c,t)),l&&(o=e.apply(r,s),r=s=null),o}},y.wrap=function(e,t){return y.partial(t,e)},y.negate=function(e){return function(){return!e.apply(this,arguments)}},y.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},y.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},y.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},y.once=y.partial(y.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(e){if(!y.isObject(e))return[];if(f)return f(e);var t=[];for(var n in e)y.has(e,n)&&t.push(n);return O&&i(e,t),t},y.allKeys=function(e){if(!y.isObject(e))return[];var t=[];for(var n in e)t.push(n);return O&&i(e,t),t},y.values=function(e){for(var t=y.keys(e),n=t.length,i=Array(n),s=0;n>s;s++)i[s]=e[t[s]];return i},y.mapObject=function(e,t,n){t=b(t,n);for(var i,s=y.keys(e),r=s.length,a={},o=0;r>o;o++)i=s[o],a[i]=t(e[i],i,e);return a},y.pairs=function(e){for(var t=y.keys(e),n=t.length,i=Array(n),s=0;n>s;s++)i[s]=[t[s],e[t[s]]];return i},y.invert=function(e){for(var t={},n=y.keys(e),i=0,s=n.length;s>i;i++)t[e[n[i]]]=n[i];return t},y.functions=y.methods=function(e){var t=[];for(var n in e)y.isFunction(e[n])&&t.push(n);return t.sort()},y.extend=_(y.allKeys),y.extendOwn=y.assign=_(y.keys),y.findKey=function(e,t,n){t=b(t,n);for(var i,s=y.keys(e),r=0,a=s.length;a>r;r++)if(i=s[r],t(e[i],i,e))return i},y.pick=function(e,t,n){var i,s,r={},a=e;if(null==a)return r;y.isFunction(t)?(s=y.allKeys(a),i=w(t,n)):(s=I(arguments,!1,!1,1),i=function(e,t,n){return t in n},a=Object(a));for(var o=0,c=s.length;c>o;o++){var l=s[o],u=a[l];i(u,l,a)&&(r[l]=u)}return r},y.omit=function(e,t,n){if(y.isFunction(t))t=y.negate(t);else{var i=y.map(I(arguments,!1,!1,1),String);t=function(e,t){return!y.contains(i,t)}}return y.pick(e,t,n)},y.defaults=_(y.allKeys,!0),y.create=function(e,t){var n=x(e);return t&&y.extendOwn(n,t),n},y.clone=function(e){return y.isObject(e)?y.isArray(e)?e.slice():y.extend({},e):e},y.tap=function(e,t){return t(e),e},y.isMatch=function(e,t){var n=y.keys(t),i=n.length;if(null==e)return!i;for(var s=Object(e),r=0;i>r;r++){var a=n[r];if(t[a]!==s[a]||!(a in s))return!1}return!0};var T=function(e,t,n,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof y&&(e=e._wrapped),t instanceof y&&(t=t._wrapped);var s=h.call(e);if(s!==h.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var r="[object Array]"===s;if(!r){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,o=t.constructor;if(a!==o&&!(y.isFunction(a)&&a instanceof a&&y.isFunction(o)&&o instanceof o)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],i=i||[];for(var c=n.length;c--;)if(n[c]===e)return i[c]===t;if(n.push(e),i.push(t),r){if(c=e.length,c!==t.length)return!1;for(;c--;)if(!T(e[c],t[c],n,i))return!1}else{var l,u=y.keys(e);if(c=u.length,y.keys(t).length!==c)return!1;for(;c--;)if(l=u[c],!y.has(t,l)||!T(e[l],t[l],n,i))return!1}return n.pop(),i.pop(),!0};y.isEqual=function(e,t){return T(e,t)},y.isEmpty=function(e){return null==e?!0:M(e)&&(y.isArray(e)||y.isString(e)||y.isArguments(e))?0===e.length:0===y.keys(e).length},y.isElement=function(e){return!(!e||1!==e.nodeType)},y.isArray=p||function(e){return"[object Array]"===h.call(e)},y.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){y["is"+e]=function(t){return h.call(t)==="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(e){return y.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(y.isFunction=function(e){return"function"==typeof e||!1}),y.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},y.isNaN=function(e){return y.isNumber(e)&&e!==+e},y.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===h.call(e)},y.isNull=function(e){return null===e},y.isUndefined=function(e){return void 0===e},y.has=function(e,t){return null!=e&&d.call(e,t)},y.noConflict=function(){return s._=r,this},y.identity=function(e){return e},y.constant=function(e){return function(){return e}},y.noop=function(){},y.property=k,y.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},y.matcher=y.matches=function(e){return e=y.extendOwn({},e),function(t){return y.isMatch(t,e)}},y.times=function(e,t,n){var i=Array(Math.max(0,e));t=w(t,n,1);for(var s=0;e>s;s++)i[s]=t(s);return i},y.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},y.now=Date.now||function(){return(new Date).getTime()};var R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=y.invert(R),$=function(e){var t=function(t){return e[t]},n="(?:"+y.keys(e).join("|")+")",i=RegExp(n),s=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(s,t):e}};y.escape=$(R),y.unescape=$(N),y.result=function(e,t,n){var i=null==e?void 0:e[t];return void 0===i&&(i=n),y.isFunction(i)?i.call(e):i};var L=0;y.uniqueId=function(e){var t=++L+"";return e?e+t:t},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var V=/(.)^/,j={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,D=function(e){return"\\"+j[e]};y.template=function(e,t,n){!t&&n&&(t=n),t=y.defaults({},t,y.templateSettings);var i=RegExp([(t.escape||V).source,(t.interpolate||V).source,(t.evaluate||V).source].join("|")+"|$","g"),s=0,r="__p+='";e.replace(i,function(t,n,i,a,o){return r+=e.slice(s,o).replace(B,D),s=o+t.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),t}),r+="';\n",t.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var a=new Function(t.variable||"obj","_",r)}catch(o){throw o.source=r,o}var c=function(e){return a.call(this,e,y)},l=t.variable||"obj";return c.source="function("+l+"){\n"+r+"}",c},y.chain=function(e){var t=y(e);return t._chain=!0,t};var H=function(e,t){return e._chain?y(t).chain():t};y.mixin=function(e){y.each(y.functions(e),function(t){var n=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return l.apply(e,arguments),H(this,n.apply(y,e))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];y.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],H(this,n)}}),y.each(["concat","join","slice"],function(e){var t=a[e];y.prototype[e]=function(){return H(this,t.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return y})}.call(this),define("jquery",[],function(){"use strict";return $}),function(e,t){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,i,s){e.Backbone=t(e,s,n,i)});else if("undefined"!=typeof exports){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,i){var s=e.Backbone,r=[],a=(r.push,r.slice);r.splice;t.VERSION="1.1.2",t.$=i,t.noConflict=function(){return e.Backbone=s,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=t.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,i){if(!l(this,"once",e,[t,i])||!t)return this;var s=this,r=n.once(function(){s.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,i)},off:function(e,t,i){var s,r,a,o,c,u,h,d;if(!this._events||!l(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events=void 0,this;for(o=e?[e]:n.keys(this._events),c=0,u=o.length;u>c;c++)if(e=o[c],a=this._events[e]){if(this._events[e]=s=[],t||i)for(h=0,d=a.length;d>h;h++)r=a[h],(t&&t!==r.callback&&t!==r.callback._callback||i&&i!==r.context)&&s.push(r);s.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&u(n,t),i&&u(i,arguments),this},stopListening:function(e,t,i){var s=this._listeningTo;if(!s)return this;var r=!t&&!i;i||"object"!=typeof t||(i=this),e&&((s={})[e._listenId]=e);for(var a in s)e=s[a],e.off(t,i,this),(r||n.isEmpty(e._events))&&delete this._listeningTo[a];return this}},c=/\s+/,l=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var s in n)e[t].apply(e,[s,n[s]].concat(i));return!1}if(c.test(n)){for(var r=n.split(c),a=0,o=r.length;o>a;a++)e[t].apply(e,[r[a]].concat(i));return!1}return!0},u=function(e,t){var n,i=-1,s=e.length,r=t[0],a=t[1],o=t[2];switch(t.length){case 0:for(;++i<s;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<s;)(n=e[i]).callback.call(n.ctx,r);return;case 2:for(;++i<s;)(n=e[i]).callback.call(n.ctx,r,a);return;case 3:for(;++i<s;)(n=e[i]).callback.call(n.ctx,r,a,o);return;default:for(;++i<s;)(n=e[i]).callback.apply(n.ctx,t);return}},h={listenTo:"on",listenToOnce:"once"};n.each(h,function(e,t){o[t]=function(t,i,s){var r=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=n.uniqueId("l"));return r[a]=t,s||"object"!=typeof i||(s=this),t[e](i,s,this),this}}),o.bind=o.on,o.unbind=o.off,n.extend(t,o);var d=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=n.defaults({},i,n.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var s,r,a,o,c,l,u,h;if(null==e)return this;if("object"==typeof e?(r=e,i=t):(r={})[e]=t,i||(i={}),!this._validate(r,i))return!1;a=i.unset,c=i.silent,o=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=n.clone(this.attributes),this.changed={}),h=this.attributes,u=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(s in r)t=r[s],n.isEqual(h[s],t)||o.push(s),n.isEqual(u[s],t)?delete this.changed[s]:this.changed[s]=t,a?delete h[s]:h[s]=t;if(!c){o.length&&(this._pending=i);for(var d=0,p=o.length;p>d;d++)this.trigger("change:"+o[d],this,h[o[d]],i)}if(l)return this;if(!c)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,i=!1,s=this._changing?this._previousAttributes:this.attributes;for(var r in e)n.isEqual(s[r],t=e[r])||((i||(i={}))[r]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(n){return t.set(t.parse(n,e),e)?(i&&i(t,n,e),void t.trigger("sync",t,n,e)):!1},V(this,e),this.sync("read",this,e)},save:function(e,t,i){var s,r,a,o=this.attributes;if(null==e||"object"==typeof e?(s=e,i=t):(s={})[e]=t,i=n.extend({validate:!0},i),s&&!i.wait){if(!this.set(s,i))return!1}else if(!this._validate(s,i))return!1;s&&i.wait&&(this.attributes=n.extend({},o,s)),void 0===i.parse&&(i.parse=!0);var c=this,l=i.success;return i.success=function(e){c.attributes=o;var t=c.parse(e,i);return i.wait&&(t=n.extend(s||{},t)),n.isObject(t)&&!c.set(t,i)?!1:(l&&l(c,e,i),void c.trigger("sync",c,e,i))},V(this,i),r=this.isNew()?"create":i.patch?"patch":"update","patch"===r&&(i.attrs=s),a=this.sync(r,this,i),s&&i.wait&&(this.attributes=o),a},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,s=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&s(),i&&i(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;V(this,e);var r=this.sync("delete",this,e);return e.wait||s(),r},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||L();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return i?(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];n.each(p,function(e){d.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var f=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};n.extend(f.prototype,o,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,g))},remove:function(e,t){var i=!n.isArray(e);e=i?[e]:n.clone(e),t||(t={});var s,r,a,o;for(s=0,r=e.length;r>s;s++)o=e[s]=this.get(e[s]),o&&(delete this._byId[o.id],delete this._byId[o.cid],a=this.indexOf(o),this.models.splice(a,1),this.length--,t.silent||(t.index=a,o.trigger("remove",o,this,t)),this._removeReference(o,t));return i?e[0]:e},set:function(e,t){t=n.defaults({},t,m),t.parse&&(e=this.parse(e,t));var i=!n.isArray(e);e=i?e?[e]:[]:n.clone(e);var s,r,a,o,c,l,u,h=t.at,p=this.model,f=this.comparator&&null==h&&t.sort!==!1,g=n.isString(this.comparator)?this.comparator:null,v=[],y=[],w={},b=t.add,_=t.merge,x=t.remove,k=!f&&b&&x?[]:!1;for(s=0,r=e.length;r>s;s++){if(c=e[s]||{},a=c instanceof d?o=c:c[p.prototype.idAttribute||"id"],l=this.get(a))x&&(w[l.cid]=!0),_&&(c=c===o?o.attributes:c,t.parse&&(c=l.parse(c,t)),l.set(c,t),f&&!u&&l.hasChanged(g)&&(u=!0)),e[s]=l;else if(b){if(o=e[s]=this._prepareModel(c,t),!o)continue;v.push(o),this._addReference(o,t)}o=l||o,!k||!o.isNew()&&w[o.id]||k.push(o),w[o.id]=!0}if(x){for(s=0,r=this.length;r>s;++s)w[(o=this.models[s]).cid]||y.push(o);y.length&&this.remove(y,t)}if(v.length||k&&k.length)if(f&&(u=!0),this.length+=v.length,null!=h)for(s=0,r=v.length;r>s;s++)this.models.splice(h+s,0,v[s]);else{k&&(this.models.length=0);var C=k||v;for(s=0,r=C.length;r>s;s++)this.models.push(C[s])}if(u&&this.sort({silent:!0}),!t.silent){for(s=0,r=v.length;r>s;s++)(o=v[s]).trigger("add",o,this,t);(u||k&&k.length)&&this.trigger("sort",this,t)}return i?e[0]:e},reset:function(e,t){t||(t={});for(var i=0,s=this.models.length;s>i;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return a.apply(this.models,arguments)},get:function(e){return null!=e?this._byId[e]||this._byId[e.id]||this._byId[e.cid]:void 0},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(n){var s=e.reset?"reset":"set";i[s](n,e),t&&t(i,n,e),i.trigger("sync",i,n,e)},V(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,s=t.success;return t.success=function(e,n){t.wait&&i.add(e,t),s&&s(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_addReference:function(e,t){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(v,function(e){f.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var y=["groupBy","countBy","sortBy","indexBy"];n.each(y,function(e){f.prototype[e]=function(t,i){var s=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,s,i)}});var w=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,_)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,_=["model","collection","el","id","attributes","className","tagName","events"];n.extend(w.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),i){var s=t.match(b),r=s[1],a=s[2];i=n.bind(i,this),r+=".delegateEvents"+this.cid,""===a?this.$el.on(r,i):this.$el.on(r,a,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var i=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,s){var r=k[e];n.defaults(s||(s={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(s.url||(a.url=n.result(i,"url")||L()),null!=s.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(s.attrs||i.toJSON(s))),s.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),s.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",s.emulateJSON&&(a.data._method=r);var o=s.beforeSend;s.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",r),o?o.apply(this,arguments):void 0}}"GET"===a.type||s.emulateJSON||(a.processData=!1),"PATCH"===a.type&&x&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var c=s.xhr=t.ajax(n.extend(a,s));return i.trigger("request",i,c,s),c};var x=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,M=/(\(\?)?:\w+/g,E=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,o,{initialize:function(){},route:function(e,i,s){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(s=i,i=""),s||(s=this[i]);var r=this;return t.history.route(e,function(n){var a=r._extractParameters(e,n);r.execute(s,a),r.trigger.apply(r,["route:"+i].concat(a)),r.trigger("route",i,a),t.history.trigger("route",r,i,a)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){
if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(I,"\\$&").replace(S,"(?:$1)?").replace(M,function(e,t){return t?e:"([^/?]+)"}).replace(E,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}});var P=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},O=/^[#\/]|\s+$/g,A=/^\/+|\/+$/g,T=/msie [\w.]+/,R=/\/$/,N=/#.*$/;P.started=!1,n.extend(P.prototype,o,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(R,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(O,"")},start:function(e){if(P.started)throw new Error("Backbone.history has already been started");P.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),s=document.documentMode,r=T.exec(navigator.userAgent.toLowerCase())&&(!s||7>=s);if(this.root=("/"+this.root+"/").replace(A,"/"),r&&this._wantsHashChange){var a=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(i)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var o=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&o.hash&&(this.fragment=this.getHash().replace(O,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),P.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!P.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(N,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new P;var $=function(e,t){var i,s=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return s.apply(this,arguments)},n.extend(i,s,t);var r=function(){this.constructor=i};return r.prototype=s.prototype,i.prototype=new r,e&&n.extend(i.prototype,e),i.__super__=s.prototype,i};d.extend=f.extend=C.extend=w.extend=P.extend=$;var L=function(){throw new Error('A "url" property or function must be specified')},V=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}};return t}),function(e,t){if("function"==typeof define&&define.amd)define("marionette",["backbone","underscore"],function(n,i){return e.Marionette=e.Mn=t(e,n,i)});else if("undefined"!=typeof exports){var n=require("backbone"),i=require("underscore");module.exports=t(e,n,i)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,n){"use strict";!function(e,t){var n=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;return this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var n=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===n?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[n],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,n){t.each(this._views,function(i){t.isFunction(i[e])&&i[e].apply(i,n||[])})},_updateLength:function(){this.length=t.size(this._views)}});var i=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return t.each(i,function(e){n.prototype[e]=function(){var n=t.values(this._views),i=[n].concat(t.toArray(arguments));return t[e].apply(t,i)}}),n}(e,t),e.ChildViewContainer.VERSION="0.1.11",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=n,this},e.ChildViewContainer}(t,n),function(e,t){var n=e.Wreqr,i=e.Wreqr={};return e.Wreqr.VERSION="1.3.6",e.Wreqr.noConflict=function(){return e.Wreqr=n,this},i.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var i=null;t.isObject(e)&&!t.isFunction(e)&&(i=e.context,e=e.callback),this.setHandler(n,e,i)},this)},setHandler:function(e,t,n){var i={callback:t,context:n};this._wreqrHandlers[e]=i,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){return t.callback.apply(t.context,arguments)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,t),i.CommandStorage=function(){var n=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(n.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var n=this.getCommands(e);n.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),n}(),i.Commands=function(e,t){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),e.Handlers.prototype.constructor.apply(this,arguments)},execute:function(e){e=arguments[0];var n=t.rest(arguments);this.hasHandler(e)?this.getHandler(e).apply(this,n):this.storage.addCommand(e,n)},_executeCommands:function(e,n,i){var s=this.storage.getCommands(e);t.each(s.instances,function(e){n.apply(i,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var n,i=e.storageType||this.storageType;n=t.isFunction(i)?new i:i,this.storage=n}})}(i,t),i.RequestResponse=function(e,t){return e.Handlers.extend({request:function(e){return this.hasHandler(e)?this.getHandler(e).apply(this,t.rest(arguments)):void 0}})}(i,t),i.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,t),i.Channel=function(n){var i=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(i.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,n,i){if(n){i=i||this;var s="vent"===e?"on":"setHandler";t.each(n,function(n,r){this[e][s](r,t.bind(n,i))},this)}}}),i}(i),i.radio=function(e,t){var n=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(n.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var n=this._channels[t];return n||(n=new e.Channel(t),this._channels[t]=n),n},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(i[e],function(t){this[e][t]=s(this,e,t)},this)},this)}});var i={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},s=function(e,n,i){return function(s){var r=e._getChannel(s)[n];return r[i].apply(r,t.rest(arguments))}};return new n}(i,t),e.Wreqr}(t,n);var i=e.Marionette,s=e.Mn,r=t.Marionette={};r.VERSION="2.4.5",r.noConflict=function(){return e.Marionette=i,e.Mn=s,this},t.Marionette=r,r.Deferred=t.$.Deferred,r.extend=t.Model.extend,r.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},r.mergeOptions=function(e,t){e&&n.extend(this,n.pick(e,t))},r.getOption=function(e,t){return e&&t?e.options&&void 0!==e.options[t]?e.options[t]:e[t]:void 0},r.proxyGetOption=function(e){return r.getOption(this,e)},r._getValue=function(e,t,i){return n.isFunction(e)&&(e=i?e.apply(t,i):e.call(t)),e},r.normalizeMethods=function(e){return n.reduce(e,function(e,t,i){return n.isFunction(t)||(t=this[t]),t&&(e[i]=t),e},{},this)},r.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(e){return t[e.slice(4)]})},r.normalizeUIKeys=function(e,t){return n.reduce(e,function(e,n,i){var s=r.normalizeUIString(i,t);return e[s]=n,e},{})},r.normalizeUIValues=function(e,t,i){return n.each(e,function(s,a){n.isString(s)?e[a]=r.normalizeUIString(s,t):n.isObject(s)&&n.isArray(i)&&(n.extend(s,r.normalizeUIValues(n.pick(s,i),t)),n.each(i,function(e){var i=s[e];n.isString(i)&&(s[e]=r.normalizeUIString(i,t))}))}),e},r.actAsCollection=function(e,t){var i=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];n.each(i,function(i){e[i]=function(){var e=n.values(n.result(this,t)),s=[e].concat(n.toArray(arguments));return n[i].apply(n,s)}})};var a=r.deprecate=function(e,t){n.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||a._cache[e]||(a._warn("Deprecation warning: "+e),a._cache[e]=!0)};a._console="undefined"!=typeof console?console:{},a._warn=function(){var e=a._console.warn||a._console.log||function(){};return e.apply(a._console,arguments)},a._cache={},r._triggerMethod=function(){function e(e,t,n){return n.toUpperCase()}var t=/(^|:)(\w)/gi;return function(i,s,r){var a=arguments.length<3;a&&(r=s,s=r[0]);var o,c="on"+s.replace(t,e),l=i[c];return n.isFunction(l)&&(o=l.apply(i,a?n.rest(r):r)),n.isFunction(i.trigger)&&(a+r.length>1?i.trigger.apply(i,a?r:[s].concat(n.drop(r,0))):i.trigger(s)),o}}(),r.triggerMethod=function(e){return r._triggerMethod(this,arguments)},r.triggerMethodOn=function(e){var t=n.isFunction(e.triggerMethod)?e.triggerMethod:r.triggerMethod;return t.apply(e,n.rest(arguments))},r.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,i()}function n(){e._isRendered=!0,i()}function i(){e._isShown&&e._isRendered&&r.isNodeAttached(e.el)&&r.triggerMethodOn(e,"dom:refresh",e)}e._isDomRefreshMonitored||(e._isDomRefreshMonitored=!0,e.on({show:t,render:n}))},function(e){function t(t,i,s,r){var a=r.split(/\s+/);n.each(a,function(n){var r=t[n];if(!r)throw new e.Error('Method "'+n+'" was configured as an event handler, but does not exist.');t.listenTo(i,s,r)})}function i(e,t,n,i){e.listenTo(t,n,i)}function s(e,t,i,s){var r=s.split(/\s+/);n.each(r,function(n){var s=e[n];e.stopListening(t,i,s)})}function r(e,t,n,i){e.stopListening(t,n,i)}function a(t,i,s,r,a){if(i&&s){if(!n.isObject(s))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});s=e._getValue(s,t),n.each(s,function(e,s){n.isFunction(e)?r(t,i,s,e):a(t,i,s,e)})}}e.bindEntityEvents=function(e,n,s){a(e,n,s,i,t)},e.unbindEntityEvents=function(e,t,n){a(e,t,n,r,s)},e.proxyBindEntityEvents=function(t,n){return e.bindEntityEvents(this,t,n)},e.proxyUnbindEntityEvents=function(t,n){return e.unbindEntityEvents(this,t,n)}}(r);var o=["description","fileName","lineNumber","name","message","number"];return r.Error=r.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+r.VERSION+"/",constructor:function(e,t){n.isObject(e)?(t=e,e=t.message):t||(t={});var i=Error.call(this,e);n.extend(this,n.pick(i,o),n.pick(t,o)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,r.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),r.Error.extend=r.extend,r.Callbacks=function(){this._deferred=r.Deferred(),this._callbacks=[]},n.extend(r.Callbacks.prototype,{add:function(e,t){var i=n.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),i.then(function(n){t&&(n.context=t),e.call(n.context,n.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=r.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),r.Controller=function(e){this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},r.Controller.extend=r.extend,n.extend(r.Controller.prototype,t.Events,{destroy:function(){return r._triggerMethod(this,"before:destroy",arguments),r._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:r.triggerMethod,mergeOptions:r.mergeOptions,getOption:r.proxyGetOption}),r.Object=function(e){this.options=n.extend({},n.result(this,"options"),e),this.initialize.apply(this,arguments)},r.Object.extend=r.extend,n.extend(r.Object.prototype,t.Events,{initialize:function(){},destroy:function(e){return e=e||{},this.triggerMethod("before:destroy",e),this.triggerMethod("destroy",e),this.stopListening(),this},triggerMethod:r.triggerMethod,mergeOptions:r.mergeOptions,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),r.Region=r.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new r.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),r.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e),r.MonitorDOMRefresh(e);var i=t||{},s=e!==this.currentView,a=!!i.preventDestroy,o=!!i.forceShow,c=!!this.currentView,l=s&&!a,u=s||o;if(c&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&s&&delete this.currentView._parent,l?this.empty():c&&u&&this.currentView.off("destroy",this.empty,this),u){e.once("destroy",this.empty,this),e._parent=this,this._renderView(e),c&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),r.triggerMethodOn(e,"before:show",e,this,t),c&&this.triggerMethod("swapOut",this.currentView,this,t);var h=r.isNodeAttached(this.el),d=[],p=n.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},i);return h&&p.triggerBeforeAttach&&(d=this._displayedViews(e),this._triggerAttach(d,"before:")),this.attachHtml(e),this.currentView=e,h&&p.triggerAttach&&(d=this._displayedViews(e),this._triggerAttach(d)),c&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),r.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var i=(t||"")+"attach";n.each(e,function(e){r.triggerMethodOn(e,i,e,this)},this)},_displayedViews:function(e){return n.union([e],n.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||r.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||r.triggerMethodOn(e,"render",e)},_ensureElement:function(){if(n.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new r.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new r.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new r.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,r._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,n=e||{},i=!!n.preventDestroy;return t?(t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),i||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,i&&this.$el.contents().detach(),this):this},_destroyView:function(){var e=this.currentView;e.isDestroyed||(e.supportsDestroyLifecycle||r.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||r.triggerMethodOn(e,"destroy",e))},attachView:function(e){return this.currentView&&delete this.currentView._parent,e._parent=this,this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(n.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(n.isFunction(e))return this._buildRegionFromRegionClass(e);throw new r.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var i=e.regionClass||t,s=n.omit(e,"selector","regionClass");return e.selector&&!s.el&&(s.el=e.selector),new i(s)},_buildRegionFromRegionClass:function(e){return new e}}),r.RegionManager=r.Controller.extend({constructor:function(e){this._regions={},this.length=0,r.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=r._getValue(e,this,arguments),n.reduce(e,function(e,i,s){return n.isString(i)&&(i={selector:i}),i.selector&&(i=n.defaults({},i,t)),e[s]=this.addRegion(s,i),e},{},this)},addRegion:function(e,t){var n;return n=t instanceof r.Region?t:r.Region.buildRegion(t,r.Region),this.triggerMethod("before:add:region",e,n),n._parent=this,this._store(e,n),this.triggerMethod("add:region",e,n),n},get:function(e){return this._regions[e]},getRegions:function(){return n.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return n.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return n.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),r.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),r.actAsCollection(r.RegionManager.prototype,"_regions"),r.TemplateCache=function(e){this.templateId=e},n.extend(r.TemplateCache,{templateCaches:{},get:function(e,t){var n=this.templateCaches[e];return n||(n=new r.TemplateCache(e),this.templateCaches[e]=n),n.load(t)},clear:function(){var e,t=n.toArray(arguments),i=t.length;if(i>0)for(e=0;i>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(r.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,n){var i=t.$(e);if(!i.length)throw new r.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return i.html()},compileTemplate:function(e,t){return n.template(e,t)}}),r.Renderer={render:function(e,t){if(!e)throw new r.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var i=n.isFunction(e)?e:r.TemplateCache.get(e);return i(t)}},r.View=t.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=n.bind(this.render,this),e=r._getValue(e,this),this.options=n.extend({},n.result(this,"options"),e),this._behaviors=r.Behaviors(this),t.View.call(this,this.options),r.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,n.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=r._getValue(t,this),n.extend(e,t)},normalizeUIKeys:function(e){var t=n.result(this,"_uiBindings");return r.normalizeUIKeys(e,t||n.result(this,"ui"))},normalizeUIValues:function(e,t){var i=n.result(this,"ui"),s=n.result(this,"_uiBindings");return r.normalizeUIValues(e,s||i,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(n.result(this,"triggers"));return n.reduce(e,function(e,t,n){return e[n]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var i=r._getValue(e||this.events,this);i=this.normalizeUIKeys(i),n.isUndefined(e)&&(this.events=i);var s={},a=n.result(this,"behaviorEvents")||{},o=this.configureTriggers(),c=n.result(this,"behaviorTriggers")||{};n.extend(s,a,i,o,c),t.View.prototype.delegateEvents.call(this,s)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new r.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=n.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),n.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),n.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),n.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=n.defaults({},e,{preventDefault:!0,stopPropagation:!0}),i=n.isObject(e)?t.event:e;return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation());var n={view:this,model:this.model,collection:this.collection};this.triggerMethod(i,n)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return n.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=r._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],n.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=r._triggerMethod,n=this._behaviors,i=0,s=n&&n.length;s>i;i++)t(n[i],e)},_triggerEventOnParentLayout:function(e,t){var i=this._parentLayoutView();if(i){var s=r.getOption(i,"childViewEventPrefix"),a=s+":"+e,o=[this].concat(t);r._triggerMethod(i,a,o);var c=r.getOption(i,"childEvents");c=r._getValue(c,i);var l=i.normalizeMethods(c);l&&n.isFunction(l[e])&&l[e].apply(i,o)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?n.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_parentLayoutView:function(){for(var e=this._parent;e;){if(e instanceof r.LayoutView)return e;e=e._parent}},normalizeMethods:r.normalizeMethods,mergeOptions:r.mergeOptions,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),r.ItemView=r.View.extend({constructor:function(){r.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,n.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){if(!e)throw new r.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),n=r.Renderer.render(e,t,this);return this.attachElContent(n),this}},attachElContent:function(e){return this.$el.html(e),this}}),r.CollectionView=r.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),r.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&r.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,i){var s=n.drop(arguments,3);n.each(e,function(e){r.triggerMethodOn.apply(e,[e,i,e,t].concat(s))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,i){var s=void 0!==i.at&&(i.index||t.indexOf(e));if((this.getOption("filter")||s===!1)&&(s=n.indexOf(this._filteredSortedModels(s),e)),this._shouldAddChild(e,s)){this.destroyEmptyView();var r=this.getChildView(e);this.addChild(e,r,s)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){r.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){r.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels(),i=n.some(t,function(t){return!e.findByModel(t)});if(i)this.render();else{var s=n.map(t,function(t,n){var i=e.findByModel(t);return i._index=n,i.el}),r=e.filter(function(e){return!n.contains(s,e.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(s),n.each(r,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){r.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels(),t=n.find(e,function(e,t){var n=this.children.findByModel(e);return!n||n._index!==t},this);t&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();n.each(t,function(t,n){e=this.getChildView(t),this.addChild(t,e,n)},this)},_filteredSortedModels:function(e){var t=this.getViewComparator(),i=this.collection.models;if(e=Math.min(Math.max(e,0),i.length-1),t){var s;e&&(s=i[e],i=i.slice(0,e).concat(i.slice(e+1))),i=this._sortModelsBy(i,t),s&&i.splice(e,0,s)}return this.getOption("filter")&&(i=n.filter(i,function(e,t){return this._shouldAddChild(e,t)},this)),i},_sortModelsBy:function(e,t){return"string"==typeof t?n.sortBy(e,function(e){return e.get(t)},this):1===t.length?n.sortBy(e,t,this):e.sort(n.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();
if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var n=new t.Model;this.addEmptyView(n,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var i,s=this._isShown&&!this.isBuffering&&r.isNodeAttached(this.el),a=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");n.isFunction(a)&&(a=a.call(this,e,this._emptyViewIndex));var o=this.buildChildView(e,t,a);o._parent=this,this.proxyChildEvents(o),o.once("render",function(){this._isShown&&r.triggerMethodOn(o,"before:show",o),s&&this._triggerBeforeAttach&&(i=this._getViewAndNested(o),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(o),this.renderChildView(o,this._emptyViewIndex),s&&this._triggerAttach&&(i=this._getViewAndNested(o),this._triggerMethodMany(i,this,"attach")),this._isShown&&r.triggerMethodOn(o,"show",o)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new r.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,n){var i=this.getOption("childViewOptions");i=r._getValue(i,this,[e,n]);var s=this.buildChildView(e,t,i);return this._updateIndices(s,!0,n),this.triggerMethod("before:add:child",s),this._addChildView(s,n),this.triggerMethod("add:child",s),s._parent=this,s},_updateIndices:function(e,t,n){this.getOption("sort")&&(t&&(e._index=n),this.children.each(function(n){n._index>=e._index&&(n._index+=t?1:-1)}))},_addChildView:function(e,t){var n,i=this._isShown&&!this.isBuffering&&r.isNodeAttached(this.el);this.proxyChildEvents(e),e.once("render",function(){this._isShown&&!this.isBuffering&&r.triggerMethodOn(e,"before:show",e),i&&this._triggerBeforeAttach&&(n=this._getViewAndNested(e),this._triggerMethodMany(n,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),i&&this._triggerAttach&&(n=this._getViewAndNested(e),this._triggerMethodMany(n,this,"attach")),this._isShown&&!this.isBuffering&&r.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||r.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||r.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,i){var s=n.extend({model:e},i),a=new t(s);return r.MonitorDOMRefresh(a),a},removeChildView:function(e){return e?(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||r.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||r.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1),e):e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return n.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,n){e.isBuffering?e._bufferedChildren.splice(n,0,t):e._insertBefore(t,n)||e._insertAfter(t)},_insertBefore:function(e,t){var n,i=this.getOption("sort")&&t<this.children.length-1;return i&&(n=this.children.find(function(e){return e._index===t+1})),n?(n.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),r.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},i=!0,s=this.children.map(n.identity);return n.isUndefined(t.checkEmpty)||(i=t.checkEmpty),this.children.each(this.removeChildView,this),i&&this.checkEmpty(),s},_shouldAddChild:function(e,t){var i=this.getOption("filter");return!n.isFunction(i)||i.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var i=n.toArray(arguments),s=i[0],r=this.normalizeMethods(n.result(this,"childEvents"));i[0]=t+":"+s,i.splice(1,0,e),"undefined"!=typeof r&&n.isFunction(r[s])&&r[s].apply(this,i.slice(1)),this.triggerMethod.apply(this,i)})},_getImmediateChildren:function(){return n.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(n.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),r.CompositeView=r.CollectionView.extend({constructor:function(){r.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t},serializeData:function(){var e={};return this.model&&(e=n.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&r.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),n=r.Renderer.render(t,e,this);this.attachElContent(n),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var n=this.getChildViewContainer(e);n.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},_appendReorderedChildren:function(e){var t=this.getChildViewContainer(this);t.append(e)},getChildViewContainer:function(e,t){if(e.$childViewContainer)return e.$childViewContainer;var n,i=r.getOption(e,"childViewContainer");if(i){var s=r._getValue(i,e);if(n="@"===s.charAt(0)&&e.ui?e.ui[s.substr(4)]:e.$(s),n.length<=0)throw new r.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else n=e.$el;return e.$childViewContainer=n,n},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),r.LayoutView=r.ItemView.extend({regionClass:r.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),r.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),r.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),r.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t,i){var s=this.getRegion(e);return s.show.apply(s,n.rest(arguments))},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var n={};return n[e]=t,this._buildRegions(n)[e]},addRegions:function(e){return this.regions=n.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:n.partial(n.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=r._getValue(this.regions,this,[e])||{};var i=this.getOption.call(e,"regions");i=r._getValue(i,this,[e]),n.extend(t,i),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new r.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return n.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),r.Behavior=r.Object.extend({constructor:function(e,t){this.view=t,this.defaults=n.result(this,"defaults")||{},this.options=n.extend({},this.defaults,e),this.ui=n.extend({},n.result(t,"ui"),n.result(this,"ui")),r.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),r.Behaviors=function(e,t){function n(e,i){return t.isObject(e.behaviors)?(i=n.parseBehaviors(e,i||t.result(e,"behaviors")),n.wrap(e,i,t.keys(a)),i):{}}function i(e,t){this._view=e,this._behaviors=t,this._triggers={}}function s(e){return e._uiBindings||e.ui}var r=/^(\S+)\s*(.*)$/,a={behaviorTriggers:function(e,t){var n=new i(this,t);return n.buildBehaviorTriggers()},behaviorEvents:function(n,i){var a={};return t.each(i,function(n,i){var o={},c=t.clone(t.result(n,"events"))||{};c=e.normalizeUIKeys(c,s(n));var l=0;t.each(c,function(e,s){var a=s.match(r),c=a[1]+"."+[this.cid,i,l++," "].join(""),u=a[2],h=c+u,d=t.isFunction(e)?e:n[e];d&&(o[h]=t.bind(d,n))},this),a=t.extend(a,o)},this),a}};return t.extend(n,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,i){return t.behaviorClass?t.behaviorClass:e._getValue(n.behaviorsLookup,this,[t,i])[i]},parseBehaviors:function(e,i){return t.chain(i).map(function(i,s){var r=n.getBehaviorClass(i,s),a=new r(i,e),o=n.parseBehaviors(e,t.result(a,"behaviors"));return[a].concat(o)}).flatten().value()},wrap:function(e,n,i){t.each(i,function(i){e[i]=t.partial(a[i],e[i],n)})}}),t.extend(i.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(n,i){var r=t.clone(t.result(n,"triggers"))||{};r=e.normalizeUIKeys(r,s(n)),t.each(r,t.bind(this._setHandlerForBehavior,this,n,i))},_setHandlerForBehavior:function(e,t,n,i){var s=i.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[s]=this._view._buildViewTrigger(n)}}),n}(r,n),r.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var n=this.getOption("appRoutes"),i=this._getController();this.processAppRoutes(i,n),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var n=this._getController();this._addAppRoute(n,e,t)},_processOnRoute:function(e,t){if(n.isFunction(this.onRoute)){var i=n.invert(this.getOption("appRoutes"))[e];this.onRoute(e,i,t)}},processAppRoutes:function(e,t){if(t){var i=n.keys(t).reverse();n.each(i,function(n){this._addAppRoute(e,n,t[n])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,i){var s=e[i];if(!s)throw new r.Error('Method "'+i+'" was not found on the controller');this.route(t,i,n.bind(s,e))},mergeOptions:r.mergeOptions,getOption:r.proxyGetOption,triggerMethod:r.triggerMethod,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),r.Application=r.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new r.Callbacks,this.submodules={},n.extend(this,e),this._initChannel(),r.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var i=r.Module.getClass(t),s=n.toArray(arguments);return s.unshift(this),i.create.apply(i,s)},getRegionManager:function(){return new r.RegionManager},_initializeRegions:function(e){var t=n.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var i=r.getOption(e,"regions");return n.isFunction(i)&&(i=i.call(this,e)),n.extend(t,i),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){r._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,r._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){r._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],r._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=n.result(this,"channelName")||"global",this.channel=n.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=n.result(this,"vent")||this.channel.vent,this.commands=n.result(this,"commands")||this.channel.commands,this.reqres=n.result(this,"reqres")||this.channel.reqres}}),r.Module=function(e,t,i){this.moduleName=e,this.options=n.extend({},this.options,i),this.initialize=i.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,n.isFunction(this.initialize)&&this.initialize(e,t,this.options)},r.Module.extend=r.extend,n.extend(r.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),n.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,i){if(e){var s=n.flatten([this,this.app,t,r,t.$,n,i]);e.apply(this,s)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks},triggerMethod:r.triggerMethod}),n.extend(r.Module,{create:function(e,t,i){var s=e,r=n.drop(arguments,3);t=t.split(".");var a=t.length,o=[];return o[a-1]=i,n.each(t,function(t,n){var a=s;s=this._getModule(a,t,e,i),this._addModuleDefinition(a,s,o[n],r)},this),s},_getModule:function(e,t,i,s,r){var a=n.extend({},s),o=this.getClass(s),c=e[t];return c||(c=new o(t,i,a),e[t]=c,e.submodules[t]=c),c},getClass:function(e){var t=r.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,n,i){var s=this._getDefine(n),r=this._getStartWithParent(n,t);s&&t.addDefinition(s,i),this._addStartWithParent(e,t,r)},_getStartWithParent:function(e,t){var i;return n.isFunction(e)&&e.prototype instanceof r.Module?(i=t.constructor.prototype.startWithParent,n.isUndefined(i)?!0:i):n.isObject(e)?(i=e.startWithParent,n.isUndefined(i)?!0:i):!0},_getDefine:function(e){return!n.isFunction(e)||e.prototype instanceof r.Module?n.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,n){t.startWithParent=t.startWithParent&&n,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),r}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("handlebars",[],t):"object"==typeof exports?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(){var e=v();return e.compile=function(t,n){return u.compile(t,n,e)},e.precompile=function(t,n){return u.precompile(t,n,e)},e.AST=c["default"],e.Compiler=u.Compiler,e.JavaScriptCompiler=d["default"],e.Parser=l.parser,e.parse=l.parse,e}var s=n(1)["default"];t.__esModule=!0;var r=n(2),a=s(r),o=n(21),c=s(o),l=n(22),u=n(27),h=n(28),d=s(h),p=n(25),f=s(p),m=n(20),g=s(m),v=a["default"].create,y=i();y.create=i,g["default"](y),y.Visitor=f["default"],y["default"]=y,t["default"]=y,e.exports=t["default"]},function(e,t){"use strict";t["default"]=function(e){return e&&e.__esModule?e:{"default":e}},t.__esModule=!0},function(e,t,n){"use strict";function i(){var e=new o.HandlebarsEnvironment;return p.extend(e,o),e.SafeString=l["default"],e.Exception=h["default"],e.Utils=p,e.escapeExpression=p.escapeExpression,e.VM=m,e.template=function(t){return m.template(t,e)},e}var s=n(3)["default"],r=n(1)["default"];t.__esModule=!0;var a=n(4),o=s(a),c=n(18),l=r(c),u=n(6),h=r(u),d=n(5),p=s(d),f=n(19),m=s(f),g=n(20),v=r(g),y=i();y.create=i,v["default"](y),y["default"]=y,t["default"]=y,e.exports=t["default"]},function(e,t){"use strict";t["default"]=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t},t.__esModule=!0},function(e,t,n){"use strict";function i(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},c.registerDefaultHelpers(this),l.registerDefaultDecorators(this)}var s=n(1)["default"];t.__esModule=!0,t.HandlebarsEnvironment=i;var r=n(5),a=n(6),o=s(a),c=n(7),l=n(15),u=n(17),h=s(u),d="4.0.5";t.VERSION=d;var p=7;t.COMPILER_REVISION=p;var f={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};t.REVISION_CHANGES=f;var m="[object Object]";i.prototype={constructor:i,logger:h["default"],log:h["default"].log,registerHelper:function(e,t){if(r.toString.call(e)===m){if(t)throw new o["default"]("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(r.toString.call(e)===m)r.extend(this.partials,e);else{if("undefined"==typeof t)throw new o["default"]('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(r.toString.call(e)===m){if(t)throw new o["default"]("Arg not supported with multiple decorators");r.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};var g=h["default"].log;t.log=g,t.createFrame=r.createFrame,t.logger=h["default"]},function(e,t){"use strict";function n(e){return u[e]}function i(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}function s(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1}function r(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return d.test(e)?e.replace(h,n):e}function a(e){return e||0===e?m(e)&&0===e.length?!0:!1:!0}function o(e){var t=i({},e);return t._parent=e,t}function c(e,t){return e.path=t,e}function l(e,t){return(e?e+".":"")+t}t.__esModule=!0,t.extend=i,t.indexOf=s,t.escapeExpression=r,t.isEmpty=a,t.createFrame=o,t.blockParams=c,t.appendContextPath=l;var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},h=/[&<>"'`=]/g,d=/[&<>"'`=]/,p=Object.prototype.toString;t.toString=p;var f=function(e){return"function"==typeof e};f(/x/)&&(t.isFunction=f=function(e){return"function"==typeof e&&"[object Function]"===p.call(e)}),t.isFunction=f;var m=Array.isArray||function(e){return e&&"object"==typeof e?"[object Array]"===p.call(e):!1};t.isArray=m},function(e,t){"use strict";function n(e,t){var s=t&&t.loc,r=void 0,a=void 0;s&&(r=s.start.line,a=s.start.column,e+=" - "+r+":"+a);for(var o=Error.prototype.constructor.call(this,e),c=0;c<i.length;c++)this[i[c]]=o[i[c]];Error.captureStackTrace&&Error.captureStackTrace(this,n),s&&(this.lineNumber=r,this.column=a)}t.__esModule=!0;var i=["description","fileName","lineNumber","message","name","number","stack"];n.prototype=new Error,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function i(e){a["default"](e),c["default"](e),u["default"](e),d["default"](e),f["default"](e),g["default"](e),y["default"](e)}var s=n(1)["default"];t.__esModule=!0,t.registerDefaultHelpers=i;var r=n(8),a=s(r),o=n(9),c=s(o),l=n(10),u=s(l),h=n(11),d=s(h),p=n(12),f=s(p),m=n(13),g=s(m),v=n(14),y=s(v)},function(e,t,n){"use strict";t.__esModule=!0;var i=n(5);t["default"]=function(e){e.registerHelper("blockHelperMissing",function(t,n){var s=n.inverse,r=n.fn;if(t===!0)return r(this);if(t===!1||null==t)return s(this);if(i.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):s(this);if(n.data&&n.ids){var a=i.createFrame(n.data);a.contextPath=i.appendContextPath(n.data.contextPath,n.name),n={data:a}}return r(t,n)})},e.exports=t["default"]},function(e,t,n){"use strict";var i=n(1)["default"];t.__esModule=!0;var s=n(5),r=n(6),a=i(r);t["default"]=function(e){e.registerHelper("each",function(e,t){function n(t,n,r){l&&(l.key=t,l.index=n,l.first=0===n,l.last=!!r,u&&(l.contextPath=u+t)),c+=i(e[t],{data:l,blockParams:s.blockParams([e[t],t],[u+t,null])})}if(!t)throw new a["default"]("Must pass iterator to #each");var i=t.fn,r=t.inverse,o=0,c="",l=void 0,u=void 0;if(t.data&&t.ids&&(u=s.appendContextPath(t.data.contextPath,t.ids[0])+"."),s.isFunction(e)&&(e=e.call(this)),t.data&&(l=s.createFrame(t.data)),e&&"object"==typeof e)if(s.isArray(e))for(var h=e.length;h>o;o++)o in e&&n(o,o,o===e.length-1);else{var d=void 0;for(var p in e)e.hasOwnProperty(p)&&(void 0!==d&&n(d,o-1),d=p,o++);void 0!==d&&n(d,o-1,!0)}return 0===o&&(c=r(this)),c})},e.exports=t["default"]},function(e,t,n){"use strict";var i=n(1)["default"];t.__esModule=!0;var s=n(6),r=i(s);t["default"]=function(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new r["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')})},e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(5);t["default"]=function(e){e.registerHelper("if",function(e,t){return i.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})})},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e){e.registerHelper("log",function(){for(var t=[void 0],n=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)t.push(arguments[i]);var s=1;null!=n.hash.level?s=n.hash.level:n.data&&null!=n.data.level&&(s=n.data.level),t[0]=s,e.log.apply(e,t)})},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e){e.registerHelper("lookup",function(e,t){return e&&e[t]})},e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(5);t["default"]=function(e){e.registerHelper("with",function(e,t){i.isFunction(e)&&(e=e.call(this));var n=t.fn;if(i.isEmpty(e))return t.inverse(this);var s=t.data;return t.data&&t.ids&&(s=i.createFrame(t.data),s.contextPath=i.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:s,blockParams:i.blockParams([e],[s&&s.contextPath])})})},e.exports=t["default"]},function(e,t,n){"use strict";function i(e){a["default"](e)}var s=n(1)["default"];t.__esModule=!0,t.registerDefaultDecorators=i;var r=n(16),a=s(r)},function(e,t,n){"use strict";t.__esModule=!0;var i=n(5);t["default"]=function(e){e.registerDecorator("inline",function(e,t,n,s){var r=e;return t.partials||(t.partials={},r=function(s,r){var a=n.partials;n.partials=i.extend({},a,t.partials);var o=e(s,r);return n.partials=a,o}),t.partials[s.args[0]]=s.fn,r})},e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var i=n(5),s={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=i.indexOf(s.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=s.lookupLevel(e),"undefined"!=typeof console&&s.lookupLevel(s.level)<=e){var t=s.methodMap[e];console[t]||(t="log");for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;n>r;r++)i[r-1]=arguments[r];console[t].apply(console,i)}}};t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";function n(e){this.string=e}t.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function i(e){var t=e&&e[0]||1,n=v.COMPILER_REVISION;if(t!==n){if(n>t){var i=v.REVISION_CHANGES[n],s=v.REVISION_CHANGES[t];throw new g["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+s+").")}throw new g["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function s(e,t){function n(n,i,s){s.hash&&(i=f.extend({},i,s.hash),s.ids&&(s.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,i,s);var r=t.VM.invokePartial.call(this,n,i,s);if(null==r&&t.compile&&(s.partials[s.name]=t.compile(n,e.compilerOptions,t),r=s.partials[s.name](i,s)),null!=r){if(s.indent){for(var a=r.split("\n"),o=0,c=a.length;c>o&&(a[o]||o+1!==c);o++)a[o]=s.indent+a[o];r=a.join("\n")}return r}throw new g["default"]("The partial "+s.name+" could not be compiled when running in runtime-only mode")}function i(t){function n(t){return""+e.main(s,t,s.helpers,s.partials,a,c,o)}var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=r.data;i._setup(r),!r.partial&&e.useData&&(a=l(t,a));var o=void 0,c=e.useBlockParams?[]:void 0;return e.useDepths&&(o=r.depths?t!==r.depths[0]?[t].concat(r.depths):r.depths:[t]),(n=u(e.main,n,s,r.depths||[],a,c))(t,r)}if(!t)throw new g["default"]("No environment passed to template");if(!e||!e.main)throw new g["default"]("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var s={strict:function(e,t){if(!(t in e))throw new g["default"]('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;n>i;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:f.escapeExpression,invokePartial:n,fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,i,s){var a=this.programs[e],o=this.fn(e);return t||s||i||n?a=r(this,e,o,t,n,i,s):a||(a=this.programs[e]=r(this,e,o)),a},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=f.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};return i.isTop=!0,i._setup=function(n){n.partial?(s.helpers=n.helpers,s.partials=n.partials,s.decorators=n.decorators):(s.helpers=s.merge(n.helpers,t.helpers),e.usePartial&&(s.partials=s.merge(n.partials,t.partials)),(e.usePartial||e.useDecorators)&&(s.decorators=s.merge(n.decorators,t.decorators)))},i._child=function(t,n,i,a){if(e.useBlockParams&&!i)throw new g["default"]("must pass block params");if(e.useDepths&&!a)throw new g["default"]("must pass parent depths");return r(s,t,e[t],n,0,i,a)},i}function r(e,t,n,i,s,r,a){function o(t){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=a;return a&&t!==a[0]&&(o=[t].concat(a)),n(e,t,e.helpers,e.partials,s.data||i,r&&[s.blockParams].concat(r),o)}return o=u(n,o,e,a,i,r),o.program=t,o.depth=a?a.length:0,o.blockParams=s||0,o}function a(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e}function o(e,t,n){n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var i=void 0;if(n.fn&&n.fn!==c&&(n.data=v.createFrame(n.data),i=n.data["partial-block"]=n.fn,i.partials&&(n.partials=f.extend({},n.partials,i.partials))),void 0===e&&i&&(e=i),void 0===e)throw new g["default"]("The partial "+n.name+" could not be found");return e instanceof Function?e(t,n):void 0}function c(){return""}function l(e,t){return t&&"root"in t||(t=t?v.createFrame(t):{},t.root=e),t}function u(e,t,n,i,s,r){if(e.decorator){var a={};t=e.decorator(t,a,n,i&&i[0],s,r,i),f.extend(t,a)}return t}var h=n(3)["default"],d=n(1)["default"];t.__esModule=!0,t.checkRevision=i,t.template=s,t.wrapProgram=r,t.resolvePartial=a,t.invokePartial=o,t.noop=c;var p=n(5),f=h(p),m=n(6),g=d(m),v=n(4)},function(e,t){(function(n){"use strict";t.__esModule=!0,t["default"]=function(e){var t="undefined"!=typeof n?n:window,i=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=i),e}},e.exports=t["default"]}).call(t,function(){return this}())},function(e,t){"use strict";t.__esModule=!0;var n={helpers:{helperExpression:function(e){return"SubExpression"===e.type||("MustacheStatement"===e.type||"BlockStatement"===e.type)&&!!(e.params&&e.params.length||e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!n.helpers.scopedId(e)&&!e.depth}}};t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if("Program"===e.type)return e;o["default"].yy=p,p.locInfo=function(e){return new p.SourceLocation(t&&t.srcName,e)};var n=new l["default"](t);return n.accept(o["default"].parse(e))}var s=n(1)["default"],r=n(3)["default"];t.__esModule=!0,t.parse=i;var a=n(23),o=s(a),c=n(24),l=s(c),u=n(26),h=r(u),d=n(5);t.parser=o["default"];var p={};d.extend(p,h)},function(e,t){"use strict";var n=function(){function e(){this.yy={}}var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition_plus0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,
openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,1],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(e,t,n,i,s,r,a){var o=r.length-1;switch(s){case 1:return r[o-1];case 2:this.$=i.prepareProgram(r[o]);break;case 3:this.$=r[o];break;case 4:this.$=r[o];break;case 5:this.$=r[o];break;case 6:this.$=r[o];break;case 7:this.$=r[o];break;case 8:this.$=r[o];break;case 9:this.$={type:"CommentStatement",value:i.stripComment(r[o]),strip:i.stripFlags(r[o],r[o]),loc:i.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:r[o],value:r[o],loc:i.locInfo(this._$)};break;case 11:this.$=i.prepareRawBlock(r[o-2],r[o-1],r[o],this._$);break;case 12:this.$={path:r[o-3],params:r[o-2],hash:r[o-1]};break;case 13:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!1,this._$);break;case 14:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!0,this._$);break;case 15:this.$={open:r[o-5],path:r[o-4],params:r[o-3],hash:r[o-2],blockParams:r[o-1],strip:i.stripFlags(r[o-5],r[o])};break;case 16:this.$={path:r[o-4],params:r[o-3],hash:r[o-2],blockParams:r[o-1],strip:i.stripFlags(r[o-5],r[o])};break;case 17:this.$={path:r[o-4],params:r[o-3],hash:r[o-2],blockParams:r[o-1],strip:i.stripFlags(r[o-5],r[o])};break;case 18:this.$={strip:i.stripFlags(r[o-1],r[o-1]),program:r[o]};break;case 19:var c=i.prepareBlock(r[o-2],r[o-1],r[o],r[o],!1,this._$),l=i.prepareProgram([c],r[o-1].loc);l.chained=!0,this.$={strip:r[o-2].strip,program:l,chain:!0};break;case 20:this.$=r[o];break;case 21:this.$={path:r[o-1],strip:i.stripFlags(r[o-2],r[o])};break;case 22:this.$=i.prepareMustache(r[o-3],r[o-2],r[o-1],r[o-4],i.stripFlags(r[o-4],r[o]),this._$);break;case 23:this.$=i.prepareMustache(r[o-3],r[o-2],r[o-1],r[o-4],i.stripFlags(r[o-4],r[o]),this._$);break;case 24:this.$={type:"PartialStatement",name:r[o-3],params:r[o-2],hash:r[o-1],indent:"",strip:i.stripFlags(r[o-4],r[o]),loc:i.locInfo(this._$)};break;case 25:this.$=i.preparePartialBlock(r[o-2],r[o-1],r[o],this._$);break;case 26:this.$={path:r[o-3],params:r[o-2],hash:r[o-1],strip:i.stripFlags(r[o-4],r[o])};break;case 27:this.$=r[o];break;case 28:this.$=r[o];break;case 29:this.$={type:"SubExpression",path:r[o-3],params:r[o-2],hash:r[o-1],loc:i.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:r[o],loc:i.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:i.id(r[o-2]),value:r[o],loc:i.locInfo(this._$)};break;case 32:this.$=i.id(r[o-1]);break;case 33:this.$=r[o];break;case 34:this.$=r[o];break;case 35:this.$={type:"StringLiteral",value:r[o],original:r[o],loc:i.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(r[o]),original:Number(r[o]),loc:i.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===r[o],original:"true"===r[o],loc:i.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:i.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:i.locInfo(this._$)};break;case 40:this.$=r[o];break;case 41:this.$=r[o];break;case 42:this.$=i.preparePath(!0,r[o],this._$);break;case 43:this.$=i.preparePath(!1,r[o],this._$);break;case 44:r[o-2].push({part:i.id(r[o]),original:r[o],separator:r[o-1]}),this.$=r[o-2];break;case 45:this.$=[{part:i.id(r[o]),original:r[o]}];break;case 46:this.$=[];break;case 47:r[o-1].push(r[o]);break;case 48:this.$=[r[o]];break;case 49:r[o-1].push(r[o]);break;case 50:this.$=[];break;case 51:r[o-1].push(r[o]);break;case 58:this.$=[];break;case 59:r[o-1].push(r[o]);break;case 64:this.$=[];break;case 65:r[o-1].push(r[o]);break;case 70:this.$=[];break;case 71:r[o-1].push(r[o]);break;case 78:this.$=[];break;case 79:r[o-1].push(r[o]);break;case 82:this.$=[];break;case 83:r[o-1].push(r[o]);break;case 86:this.$=[];break;case 87:r[o-1].push(r[o]);break;case 90:this.$=[];break;case 91:r[o-1].push(r[o]);break;case 94:this.$=[];break;case 95:r[o-1].push(r[o]);break;case 98:this.$=[r[o]];break;case 99:r[o-1].push(r[o]);break;case 100:this.$=[r[o]];break;case 101:r[o-1].push(r[o])}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{13:40,15:[1,20],17:39},{20:42,56:41,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:45,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:48,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:42,56:49,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:50,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,51]},{72:[1,35],86:52},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:53,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:54,38:56,39:[1,58],43:57,44:[1,59],45:55,47:[2,54]},{28:60,43:61,44:[1,59],47:[2,56]},{13:63,15:[1,20],18:[1,62]},{15:[2,48],18:[2,48]},{33:[2,86],57:64,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:65,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:66,47:[1,67]},{30:68,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:69,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:70,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:71,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:75,33:[2,80],50:72,63:73,64:76,65:[1,44],69:74,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,80]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,51]},{20:75,53:81,54:[2,84],63:82,64:76,65:[1,44],69:83,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:84,47:[1,67]},{47:[2,55]},{4:85,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:86,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:87,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:88,47:[1,67]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:75,33:[2,88],58:89,63:90,64:76,65:[1,44],69:91,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:92,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:93,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,31:94,33:[2,60],63:95,64:76,65:[1,44],69:96,70:77,71:78,72:[1,79],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,66],36:97,63:98,64:76,65:[1,44],69:99,70:77,71:78,72:[1,79],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,22:100,23:[2,52],63:101,64:76,65:[1,44],69:102,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,92],62:103,63:104,64:76,65:[1,44],69:105,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,106]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:107,72:[1,108],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,109],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,110]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:56,39:[1,58],43:57,44:[1,59],45:112,46:111,47:[2,76]},{33:[2,70],40:113,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,114]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:75,63:116,64:76,65:[1,44],67:115,68:[2,96],69:117,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,118]},{32:119,33:[2,62],74:120,75:[1,121]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:122,74:123,75:[1,121]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,124]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,125]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,109]},{20:75,63:126,64:76,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:75,33:[2,72],41:127,63:128,64:76,65:[1,44],69:129,70:77,71:78,72:[1,79],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,130]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,131]},{33:[2,63]},{72:[1,133],76:132},{33:[1,134]},{33:[2,69]},{15:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:135,74:136,75:[1,121]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,138],77:[1,137]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,139]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],55:[2,55],57:[2,20],61:[2,57],74:[2,81],83:[2,85],87:[2,18],91:[2,89],102:[2,53],105:[2,93],111:[2,19],112:[2,77],117:[2,97],120:[2,63],123:[2,69],124:[2,12],136:[2,75],137:[2,32]},parseError:function(e,t){throw new Error(e)},parse:function(e){function t(){var e;return e=n.lexer.lex()||1,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],s=[null],r=[],a=this.table,o="",c=0,l=0,u=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var h=this.lexer.yylloc;r.push(h);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,f,m,g,v,y,w,b,_,x={};;){if(m=i[i.length-1],this.defaultActions[m]?g=this.defaultActions[m]:((null===p||"undefined"==typeof p)&&(p=t()),g=a[m]&&a[m][p]),"undefined"==typeof g||!g.length||!g[0]){var k="";if(!u){_=[];for(y in a[m])this.terminals_[y]&&y>2&&_.push("'"+this.terminals_[y]+"'");k=this.lexer.showPosition?"Parse error on line "+(c+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(c+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:h,expected:_})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+p);switch(g[0]){case 1:i.push(p),s.push(this.lexer.yytext),r.push(this.lexer.yylloc),i.push(g[1]),p=null,f?(p=f,f=null):(l=this.lexer.yyleng,o=this.lexer.yytext,c=this.lexer.yylineno,h=this.lexer.yylloc,u>0&&u--);break;case 2:if(w=this.productions_[g[1]][1],x.$=s[s.length-w],x._$={first_line:r[r.length-(w||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(w||1)].first_column,last_column:r[r.length-1].last_column},d&&(x._$.range=[r[r.length-(w||1)].range[0],r[r.length-1].range[1]]),v=this.performAction.call(x,o,l,c,this.yy,g[1],s,r),"undefined"!=typeof v)return v;w&&(i=i.slice(0,-1*w*2),s=s.slice(0,-1*w),r=r.slice(0,-1*w)),i.push(this.productions_[g[1]][0]),s.push(x.$),r.push(x._$),b=a[i[i.length-2]][i[i.length-1]],i.push(b);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var s=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[s[0],s[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,s;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),a=0;a<r.length&&(n=this._input.match(this.rules[r[a]]),!n||t&&!(n[0].length>t[0].length)||(t=n,i=a,this.options.flex));a++);return t?(s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e?e:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function s(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(s(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(s(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(t.yytext=t.yytext.substr(5,t.yyleng-9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(t.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return t.yytext=s(1,2).replace(/\\"/g,'"'),80;case 32:return t.yytext=s(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return t.yytext=t.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},e}();return t.lexer=n,e.prototype=t,t.Parser=e,new e}();t.__esModule=!0,t["default"]=n},function(e,t,n){"use strict";function i(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=e}function s(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],s=e[t-2];return i?"ContentStatement"===i.type?(s||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function r(e,t,n){void 0===t&&(t=-1);var i=e[t+1],s=e[t+2];return i?"ContentStatement"===i.type?(s||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function a(e,t,n){var i=e[null==t?0:t+1];if(i&&"ContentStatement"===i.type&&(n||!i.rightStripped)){var s=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==s}}function o(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"ContentStatement"===i.type&&(n||!i.leftStripped)){var s=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==s,i.leftStripped}}var c=n(1)["default"];t.__esModule=!0;var l=n(25),u=c(l);i.prototype=new u["default"],i.prototype.Program=function(e){var t=!this.options.ignoreStandalone,n=!this.isRootSeen;this.isRootSeen=!0;for(var i=e.body,c=0,l=i.length;l>c;c++){var u=i[c],h=this.accept(u);if(h){var d=s(i,c,n),p=r(i,c,n),f=h.openStandalone&&d,m=h.closeStandalone&&p,g=h.inlineStandalone&&d&&p;h.close&&a(i,c,!0),h.open&&o(i,c,!0),t&&g&&(a(i,c),o(i,c)&&"PartialStatement"===u.type&&(u.indent=/([ \t]+$)/.exec(i[c-1].original)[1])),t&&f&&(a((u.program||u.inverse).body),o(i,c)),t&&m&&(a(i,c),o((u.inverse||u.program).body))}}return e},i.prototype.BlockStatement=i.prototype.DecoratorBlock=i.prototype.PartialBlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,i=n,c=n;if(n&&n.chained)for(i=n.body[0].program;c.chained;)c=c.body[c.body.length-1].program;var l={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:r(t.body),closeStandalone:s((i||t).body)};if(e.openStrip.close&&a(t.body,null,!0),n){var u=e.inverseStrip;u.open&&o(t.body,null,!0),u.close&&a(i.body,null,!0),e.closeStrip.open&&o(c.body,null,!0),!this.options.ignoreStandalone&&s(t.body)&&r(i.body)&&(o(t.body),a(i.body))}else e.closeStrip.open&&o(t.body,null,!0);return l},i.prototype.Decorator=i.prototype.MustacheStatement=function(e){return e.strip},i.prototype.PartialStatement=i.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function i(){this.parents=[]}function s(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")}function r(e){s.call(this,e),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")}function a(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")}var o=n(1)["default"];t.__esModule=!0;var c=n(6),l=o(c);i.prototype={constructor:i,mutating:!1,acceptKey:function(e,t){var n=this.accept(e[t]);if(this.mutating){if(n&&!i.prototype[n.type])throw new l["default"]('Unexpected node type "'+n.type+'" found when accepting '+t+" on "+e.type);e[t]=n}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new l["default"](e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;n>t;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){if(!this[e.type])throw new l["default"]("Unknown type: "+e.type,e);this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:t!==!1?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:s,Decorator:s,BlockStatement:r,DecoratorBlock:r,PartialStatement:a,PartialBlockStatement:function(e){a.call(this,e),this.acceptKey(e,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:s,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(t=t.path?t.path.original:t,e.path.original!==t){var n={loc:e.path.loc};throw new g["default"](e.path.original+" doesn't match "+t,n)}}function s(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}}function r(e){return/^\[.*\]$/.test(e)?e.substr(1,e.length-2):e}function a(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}}function o(e){return e.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function c(e,t,n){n=this.locInfo(n);for(var i=e?"@":"",s=[],r=0,a="",o=0,c=t.length;c>o;o++){var l=t[o].part,u=t[o].original!==l;if(i+=(t[o].separator||"")+l,u||".."!==l&&"."!==l&&"this"!==l)s.push(l);else{if(s.length>0)throw new g["default"]("Invalid path: "+i,{loc:n});".."===l&&(r++,a+="../")}}return{type:"PathExpression",data:e,depth:r,parts:s,original:i,loc:n}}function l(e,t,n,i,s,r){var a=i.charAt(3)||i.charAt(2),o="{"!==a&&"&"!==a,c=/\*/.test(i);return{type:c?"Decorator":"MustacheStatement",path:e,params:t,hash:n,escaped:o,strip:s,loc:this.locInfo(r)}}function u(e,t,n,s){i(e,n),s=this.locInfo(s);var r={type:"Program",body:t,strip:{},loc:s};return{type:"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:r,openStrip:{},inverseStrip:{},closeStrip:{},loc:s}}function h(e,t,n,s,r,a){s&&s.path&&i(e,s);var o=/\*/.test(e.open);t.blockParams=e.blockParams;var c=void 0,l=void 0;if(n){if(o)throw new g["default"]("Unexpected inverse block on decorator",n);n.chain&&(n.program.body[0].closeStrip=s.strip),l=n.strip,c=n.program}return r&&(r=c,c=t,t=r),{type:o?"DecoratorBlock":"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:t,inverse:c,openStrip:e.strip,inverseStrip:l,closeStrip:s&&s.strip,loc:this.locInfo(a)}}function d(e,t){if(!t&&e.length){var n=e[0].loc,i=e[e.length-1].loc;n&&i&&(t={source:n.source,start:{line:n.start.line,column:n.start.column},end:{line:i.end.line,column:i.end.column
}})}return{type:"Program",body:e,strip:{},loc:t}}function p(e,t,n,s){return i(e,n),{type:"PartialBlockStatement",name:e.path,params:e.params,hash:e.hash,program:t,openStrip:e.strip,closeStrip:n&&n.strip,loc:this.locInfo(s)}}var f=n(1)["default"];t.__esModule=!0,t.SourceLocation=s,t.id=r,t.stripFlags=a,t.stripComment=o,t.preparePath=c,t.prepareMustache=l,t.prepareRawBlock=u,t.prepareBlock=h,t.prepareProgram=d,t.preparePartialBlock=p;var m=n(6),g=f(m)},function(e,t,n){"use strict";function i(){}function s(e,t,n){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new u["default"]("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var i=n.parse(e,t),s=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(s,t)}function r(e,t,n){function i(){var i=n.parse(e,t),s=(new n.Compiler).compile(i,t),r=(new n.JavaScriptCompiler).compile(s,t,void 0,!0);return n.template(r)}function s(e,t){return r||(r=i()),r.call(this,e,t)}if(void 0===t&&(t={}),null==e||"string"!=typeof e&&"Program"!==e.type)throw new u["default"]("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var r=void 0;return s._setup=function(e){return r||(r=i()),r._setup(e)},s._child=function(e,t,n,s){return r||(r=i()),r._child(e,t,n,s)},s}function a(e,t){if(e===t)return!0;if(h.isArray(e)&&h.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!a(e[n],t[n]))return!1;return!0}}function o(e){if(!e.path.parts){var t=e.path;e.path={type:"PathExpression",data:!1,depth:0,parts:[t.original+""],original:t.original+"",loc:t.loc}}}var c=n(1)["default"];t.__esModule=!0,t.Compiler=i,t.precompile=s,t.compile=r;var l=n(6),u=c(l),h=n(5),d=n(21),p=c(d),f=[].slice;i.prototype={compiler:i,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;t>n;n++){var i=this.opcodes[n],s=e.opcodes[n];if(i.opcode!==s.opcode||!a(i.args,s.args))return!1}t=this.children.length;for(var n=0;t>n;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[];var n=t.knownHelpers;if(t.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0,lookup:!0},n)for(var i in n)i in n&&(t.knownHelpers[i]=n[i]);return this.accept(e)},compileProgram:function(e){var t=new this.compiler,n=t.compile(e,this.options),i=this.guid++;return this.usePartial=this.usePartial||n.usePartial,this.children[i]=n,this.useDepths=this.useDepths||n.useDepths,i},accept:function(e){if(!this[e.type])throw new u["default"]("Unknown type: "+e.type,e);this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,i=0;n>i;i++)this.accept(t[i]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){o(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var i=this.classifySexpr(e);"helper"===i?this.helperSexpr(e,t,n):"simple"===i?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(e){var t=e.program&&this.compileProgram(e.program),n=this.setupFullMustacheParams(e,t,void 0),i=e.path;this.useDecorators=!0,this.opcode("registerDecorator",n.length,i.original)},PartialStatement:function(e){this.usePartial=!0;var t=e.program;t&&(t=this.compileProgram(e.program));var n=e.params;if(n.length>1)throw new u["default"]("Unsupported number of partial arguments: "+n.length,e);n.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):n.push({type:"PathExpression",parts:[],depth:0}));var i=e.name.original,s="SubExpression"===e.name.type;s&&this.accept(e.name),this.setupFullMustacheParams(e,t,void 0,!0);var r=e.indent||"";this.options.preventIndent&&r&&(this.opcode("appendContent",r),r=""),this.opcode("invokePartial",s,i,r),this.opcode("append")},PartialBlockStatement:function(e){this.PartialStatement(e)},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(e){this.DecoratorBlock(e)},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){o(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var i=e.path,s=i.parts[0],r=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),i.strict=!0,this.accept(i),this.opcode("invokeAmbiguous",s,r)},simpleSexpr:function(e){var t=e.path;t.strict=!0,this.accept(t),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),s=e.path,r=s.parts[0];if(this.options.knownHelpers[r])this.opcode("invokeKnownHelper",i.length,r);else{if(this.options.knownHelpersOnly)throw new u["default"]("You specified knownHelpersOnly, but used the unknown helper "+r,e);s.strict=!0,s.falsy=!0,this.accept(s),this.opcode("invokeHelper",i.length,s.original,p["default"].helpers.simpleId(s))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=p["default"].helpers.scopedId(e),i=!e.depth&&!n&&this.blockParamIndex(t);i?this.opcode("lookupBlockParam",i,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts,e.strict)):this.opcode("lookupOnContext",e.parts,e.falsy,e.strict,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,i=t.length;for(this.opcode("pushHash");i>n;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:f.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=p["default"].helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),i=!n&&p["default"].helpers.helperExpression(e),s=!n&&(i||t);if(s&&!i){var r=e.path.parts[0],a=this.options;a.knownHelpers[r]?i=!0:a.knownHelpersOnly&&(s=!1)}return i?"helper":s?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;n>t;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(!e.parts||p["default"].helpers.scopedId(e)||e.depth||(n=this.blockParamIndex(e.parts[0])),n){var i=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,i)}else t=e.original||t,t.replace&&(t=t.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,i){var s=e.params;return this.pushParams(s),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",i),s},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;n>t;t++){var i=this.options.blockParams[t],s=i&&h.indexOf(i,e);if(i&&s>=0)return[t,s]}}}},function(e,t,n){"use strict";function i(e){this.value=e}function s(){}function r(e,t,n,i){var s=t.popStack(),r=0,a=n.length;for(e&&a--;a>r;r++)s=t.nameLookup(s,n[r],i);return e?[t.aliasable("container.strict"),"(",s,", ",t.quotedString(n[r]),")"]:s}var a=n(1)["default"];t.__esModule=!0;var o=n(4),c=n(6),l=a(c),u=n(5),h=n(29),d=a(h);s.prototype={nameLookup:function(e,t){return s.isValidJavaScriptVariableName(t)?[e,".",t]:[e,"[",JSON.stringify(t),"]"]},depthedLookup:function(e){return[this.aliasable("container.lookup"),'(depths, "',e,'")']},compilerInfo:function(){var e=o.COMPILER_REVISION,t=o.REVISION_CHANGES[e];return[e,t]},appendToBuffer:function(e,t,n){return u.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||e.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var s=e.opcodes,r=void 0,a=void 0,o=void 0,c=void 0;for(o=0,c=s.length;c>o;o++)r=s[o],this.source.currentLocation=r.loc,a=a||r.loc,this[r.opcode].apply(this,r.args);if(this.source.currentLocation=a,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new l["default"]("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend("var decorators = container.decorators;\n"),this.decorators.push("return fn;"),i?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var u=this.createFunctionContext(i);if(this.isChild)return u;var h={compiler:this.compilerInfo(),main:u};this.decorators&&(h.main_d=this.decorators,h.useDecorators=!0);var d=this.context,p=d.programs,f=d.decorators;for(o=0,c=p.length;c>o;o++)p[o]&&(h[o]=p[o],f[o]&&(h[o+"_d"]=f[o],h.useDecorators=!0));return this.environment.usePartial&&(h.usePartial=!0),this.options.data&&(h.useData=!0),this.useDepths&&(h.useDepths=!0),this.useBlockParams&&(h.useBlockParams=!0),this.options.compat&&(h.compat=!0),i?h.compilerOptions=this.options:(h.compiler=JSON.stringify(h.compiler),this.source.currentLocation={start:{line:1,column:0}},h=this.objectLiteral(h),t.srcName?(h=h.toStringWithSourceMap({file:t.destName}),h.map=h.map&&h.map.toString()):h=h.toString()),h},preamble:function(){this.lastContext=0,this.source=new d["default"](this.options.srcName),this.decorators=new d["default"](this.options.srcName)},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));var i=0;for(var s in this.aliases){var r=this.aliases[s];this.aliases.hasOwnProperty(s)&&r.children&&r.referenceCount>1&&(t+=", alias"+ ++i+"="+s,r.children[0]="alias"+i)}var a=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&a.push("blockParams"),this.useDepths&&a.push("depths");var o=this.mergeSource(t);return e?(a.push(o),Function.apply(this,a)):this.source.wrap(["function(",a.join(","),") {\n  ",o,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,i=void 0,s=void 0,r=void 0,a=void 0;return this.source.each(function(e){e.appendToBuffer?(r?e.prepend("  + "):r=e,a=e):(r&&(s?r.prepend("buffer += "):i=!0,a.add(";"),r=a=void 0),s=!0,t||(n=!1))}),n?r?(r.prepend("return "),a.add(";")):s||this.source.push('return "";'):(e+=", buffer = "+(i?"":this.initializeBuffer()),r?(r.prepend("return buffer + "),a.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(i?"":";\n")),this.source.merge()},blockValue:function(e){var t=this.aliasable("helpers.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var i=this.popStack();n.splice(1,0,i),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("helpers.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(e){return[" != null ? ",e,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n,i){var s=0;i||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[s++])),this.resolvePath("context",e,s,t,n)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t,n){e?this.pushStackLiteral("container.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0,n)},resolvePath:function(e,t,n,i,s){var a=this;if(this.options.strict||this.options.assumeObjects)return void this.push(r(this.options.strict&&s,this,t,e));for(var o=t.length;o>n;n++)this.replaceStack(function(s){var r=a.nameLookup(s,t[n],e);return i?[" && ",r]:[" != null ? ",r," : ",s]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},registerDecorator:function(e,t){var n=this.nameLookup("decorators",t,"decorator"),i=this.setupHelperArgs(t,e);this.decorators.push(["fn = ",this.decorators.functionCall(n,"",["fn","props","container",i])," || fn;"])},invokeHelper:function(e,t,n){var i=this.popStack(),s=this.setupHelper(e,t),r=n?[s.name," || "]:"",a=["("].concat(r,i);this.options.strict||a.push(" || ",this.aliasable("helpers.helperMissing")),a.push(")"),this.push(this.source.functionCall(a,"call",s.callParams))},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),s=this.lastHelper=this.nameLookup("helpers",e,"helper"),r=["(","(helper = ",s," || ",n,")"];this.options.strict||(r[0]="(helper = ",r.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",r,i.paramsInit?["),(",i.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",i.callParams)," : helper))"])},invokePartial:function(e,t,n){var i=[],s=this.setupParams(t,1,i);e&&(t=this.popStack(),delete s.name),n&&(s.indent=JSON.stringify(n)),s.helpers="helpers",s.partials="partials",s.decorators="container.decorators",e?i.unshift(t):i.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(s.depths="depths"),s=this.objectLiteral(s),i.push(s),this.push(this.source.functionCall("container.invokePartial","",i))},assignToHash:function(e){var t=this.popStack(),n=void 0,i=void 0,s=void 0;this.trackIds&&(s=this.popStack()),this.stringParams&&(i=this.popStack(),n=this.popStack());var r=this.hash;n&&(r.contexts[e]=n),i&&(r.types[e]=i),s&&(r.ids[e]=s),r.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:s,compileChildren:function(e,t){for(var n=e.children,i=void 0,s=void 0,r=0,a=n.length;a>r;r++){i=n[r],s=new this.compiler;var o=this.matchExistingProgram(i);null==o?(this.context.programs.push(""),o=this.context.programs.length,i.index=o,i.name="program"+o,this.context.programs[o]=s.compile(i,t,this.context,!this.precompile),this.context.decorators[o]=s.decorators,this.context.environments[o]=i,this.useDepths=this.useDepths||s.useDepths,this.useBlockParams=this.useBlockParams||s.useBlockParams):(i.index=o,i.name="program"+o,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;n>t;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"container.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof i||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new i(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,s=void 0,r=void 0;if(!this.isInline())throw new l["default"]("replaceStack on non-inline");var a=this.popStack(!0);if(a instanceof i)n=[a.value],t=["(",n],r=!0;else{s=!0;var o=this.incrStack();t=["((",this.push(o)," = ",a,")"],n=this.topStack()}var c=e.call(this,n);r||this.popStack(),s&&this.stackSlot--,this.push(t.concat(c,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;n>t;t++){var s=e[t];if(s instanceof i)this.compileStack.push(s);else{var r=this.incrStack();this.pushSource([r," = ",s,";"]),this.compileStack.push(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof i)return n.value;if(!t){if(!this.stackSlot)throw new l["default"]("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof i?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):(t=this.aliases[e]=this.source.wrap(e),t.aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var i=[],s=this.setupHelperArgs(t,e,i,n),r=this.nameLookup("helpers",t,"helper"),a=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : {}");return{params:i,paramsInit:s,name:r,callParams:[a].concat(i)}},setupParams:function(e,t,n){var i={},s=[],r=[],a=[],o=!n,c=void 0;o&&(n=[]),i.name=this.quotedString(e),i.hash=this.popStack(),this.trackIds&&(i.hashIds=this.popStack()),this.stringParams&&(i.hashTypes=this.popStack(),i.hashContexts=this.popStack());var l=this.popStack(),u=this.popStack();(u||l)&&(i.fn=u||"container.noop",i.inverse=l||"container.noop");for(var h=t;h--;)c=this.popStack(),n[h]=c,this.trackIds&&(a[h]=this.popStack()),this.stringParams&&(r[h]=this.popStack(),s[h]=this.popStack());return o&&(i.args=this.source.generateArray(n)),this.trackIds&&(i.ids=this.source.generateArray(a)),this.stringParams&&(i.types=this.source.generateArray(r),i.contexts=this.source.generateArray(s)),this.options.data&&(i.data="data"),this.useBlockParams&&(i.blockParams="blockParams"),i},setupHelperArgs:function(e,t,n,i){var s=this.setupParams(e,t,n);return s=this.objectLiteral(s),i?(this.useRegister("options"),n.push("options"),["options=",s]):n?(n.push(s),""):s}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=s.RESERVED_WORDS={},n=0,i=e.length;i>n;n++)t[e[n]]=!0}(),s.isValidJavaScriptVariableName=function(e){return!s.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t["default"]=s,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t,n){if(r.isArray(e)){for(var i=[],s=0,a=e.length;a>s;s++)i.push(t.wrap(e[s],n));return i}return"boolean"==typeof e||"number"==typeof e?e+"":e}function s(e){this.srcFile=e,this.source=[]}t.__esModule=!0;var r=n(5),a=void 0;try{}catch(o){}a||(a=function(e,t,n,i){this.src="",i&&this.add(i)},a.prototype={add:function(e){r.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){r.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),s.prototype={isEmpty:function(){return!this.source.length},prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each(function(t){e.add(["  ",t,"\n"])}),e},each:function(e){for(var t=0,n=this.source.length;n>t;t++)e(this.source[t])},empty:function(){var e=this.currentLocation||{start:{}};return new a(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof a?e:(e=i(e,this,t),new a(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var s=i(e[n],this);"undefined"!==s&&t.push([this.quotedString(n),":",s])}var r=this.generateList(t);return r.prepend("{"),r.add("}"),r},generateList:function(e){for(var t=this.empty(),n=0,s=e.length;s>n;n++)n&&t.add(","),t.add(i(e[n],this));return t},generateArray:function(e){var t=this.generateList(e);return t.prepend("["),t.add("]"),t}},t["default"]=s,e.exports=t["default"]}])}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define("backbone.radio",["underscore","backbone"],t):(e.Backbone=e.Backbone||{},e.Backbone.Radio=t(e._,e.Backbone))}(this,function(e,t){"use strict";function n(e,t,n,i){var s=e[t];return n&&n!==s.callback&&n!==s.callback._callback||i&&i!==s.context?void 0:(delete e[t],!0)}function i(t,i,s,r){t||(t={});for(var a=i?[i]:e.keys(t),o=!1,c=0,l=a.length;l>c;c++)i=a[c],t[i]&&n(t,i,s,r)&&(o=!0);return o}function s(t){return u[t]||(u[t]=e.partial(c.log,t))}function r(t){return e.isFunction(t)?t:function(){return t}}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t;var a={};a["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};var o=t.Radio,c=t.Radio={};c.VERSION="1.0.4",c.noConflict=function(){return t.Radio=o,this},c.DEBUG=!1,c._debugText=function(e,t,n){return e+(n?" on the "+n+" channel":"")+': "'+t+'"'},c.debugLog=function(e,t,n){c.DEBUG&&console&&console.warn&&console.warn(c._debugText(e,t,n))};var l=/\s+/;c._eventsApi=function(t,n,i,s){if(!i)return!1;var r={};if("object"===("undefined"==typeof i?"undefined":a["typeof"](i))){for(var o in i){var c=t[n].apply(t,[o,i[o]].concat(s));l.test(o)?e.extend(r,c):r[o]=c}return r}if(l.test(i)){for(var u=i.split(l),h=0,d=u.length;d>h;h++)r[u[h]]=t[n].apply(t,[u[h]].concat(s));return r}return!1},c._callHandler=function(e,t,n){var i=n[0],s=n[1],r=n[2];switch(n.length){case 0:return e.call(t);case 1:return e.call(t,i);case 2:return e.call(t,i,s);case 3:return e.call(t,i,s,r);default:return e.apply(t,n)}};var u={};e.extend(c,{log:function(t,n){if("undefined"!=typeof console){var i=e.drop(arguments,2);console.log("["+t+'] "'+n+'"',i)}},tuneIn:function(e){var t=c.channel(e);return t._tunedIn=!0,t.on("all",s(e)),this},tuneOut:function(e){var t=c.channel(e);return t._tunedIn=!1,t.off("all",s(e)),delete u[e],this}}),c.Requests={request:function(t){var n=e.rest(arguments),i=c._eventsApi(this,"request",t,n);if(i)return i;var s=this.channelName,r=this._requests;if(s&&this._tunedIn&&c.log.apply(this,[s,t].concat(n)),r&&(r[t]||r["default"])){var a=r[t]||r["default"];return n=r[t]?n:arguments,c._callHandler(a.callback,a.context,n)}c.debugLog("An unhandled request was fired",t,s)},reply:function(e,t,n){return c._eventsApi(this,"reply",e,[t,n])?this:(this._requests||(this._requests={}),this._requests[e]&&c.debugLog("A request was overwritten",e,this.channelName),this._requests[e]={callback:r(t),context:n||this},this)},replyOnce:function(t,n,i){if(c._eventsApi(this,"replyOnce",t,[n,i]))return this;var s=this,a=e.once(function(){return s.stopReplying(t),r(n).apply(this,arguments)});return this.reply(t,a,i)},stopReplying:function(e,t,n){return c._eventsApi(this,"stopReplying",e)?this:(e||t||n?i(this._requests,e,t,n)||c.debugLog("Attempted to remove the unregistered request",e,this.channelName):delete this._requests,this)}},c._channels={},c.channel=function(e){if(!e)throw new Error("You must provide a name for the channel.");return c._channels[e]?c._channels[e]:c._channels[e]=new c.Channel(e)},c.Channel=function(e){this.channelName=e},e.extend(c.Channel.prototype,t.Events,c.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var h,d,p=[t.Events,c.Requests];return e.each(p,function(t){e.each(t,function(t,n){c[n]=function(t){return d=e.rest(arguments),h=this.channel(t),h[n].apply(h,d)}})}),c.reset=function(t){var n=t?[this._channels[t]]:this._channels;e.invoke(n,"reset")},c}),define("radio",["require","backbone.radio"],function(e){"use strict";var t=e("backbone.radio"),n=t.channel("ui"),i=t.channel("notification"),s=t.channel("state"),r=t.channel("account"),a=t.channel("folder"),o=t.channel("message"),c={ui:n,notification:i,state:s,account:r,folder:a,message:o};for(var l in c)t.tuneIn(l);return c}),define("models/attachment",["require","backbone"],function(e){"use strict";var t=e("backbone"),n=t.Model.extend({initialize:function(){this.set("id",_.uniqueId());var e=this.get("fileName");"/"===e.charAt(0)&&(e=e.substr(1)),this.set("displayName",e)}});return n}),define("models/attachments",["require","backbone","models/attachment"],function(e){"use strict";var t=e("backbone"),n=e("models/attachment"),i=t.Collection.extend({model:n});return i}),define("text",["module"],function(e){"use strict";var t,n,i,s,r,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,u=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,d=l&&(location.port||void 0),p={},f=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(c);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=a[t];try{e=new ActiveXObject(n)}catch(i){}if(e){a=[n];break}}return e},parseName:function(e){var t,n,i,s=!1,r=e.lastIndexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!a||r>1)?(t=e.substring(0,r),n=e.substring(r+1)):t=e,i=n||t,r=i.indexOf("!"),-1!==r&&(s="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:t=i),{moduleName:t,ext:n,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,s){var r,a,o,c=t.xdRegExp.exec(e);return c?(r=c[2],a=c[3],a=a.split(":"),o=a[1],a=a[0],!(r&&r!==n||a&&a.toLowerCase()!==i.toLowerCase()||(o||a)&&o!==s)):!0},finishLoad:function(e,n,i,s){i=n?t.strip(i):i,f.isBuild&&(p[e]=i),s(i)},load:function(e,n,i,s){if(s&&s.isBuild&&!s.inlineText)return void i();f.isBuild=s&&s.isBuild;var r=t.parseName(e),a=r.moduleName+(r.ext?"."+r.ext:""),o=n.toUrl(a),c=f.useXhr||t.useXhr;return 0===o.indexOf("empty:")?void i():void(!l||c(o,u,h,d)?t.get(o,function(n){t.finishLoad(e,r.strip,n,i)},function(e){i.error&&i.error(e)}):n([a],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,i)}))},write:function(e,n,i,s){if(p.hasOwnProperty(n)){var r=t.jsEscape(p[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,s,r){var a=t.parseName(n),o=a.ext?"."+a.ext:"",c=a.moduleName+o,l=i.toUrl(a.moduleName+o)+".js";t.load(c,i,function(n){var i=function(e){return s(l,e)};i.asModule=function(e,t){return s.asModule(e,l,t)},t.write(e,c,i,r)},r)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var s=n.readFileSync(e,"utf8");"\ufeff"===s[0]&&(s=s.substring(1)),t(s)}catch(r){i&&i(r)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,n,i,s){var r,a=t.createXhr();if(a.open("GET",e,!0),s)for(r in s)s.hasOwnProperty(r)&&a.setRequestHeader(r.toLowerCase(),s[r]);f.onXhr&&f.onXhr(a,e),a.onreadystatechange=function(t){var s,r;4===a.readyState&&(s=a.status||0,s>399&&600>s?(r=new Error(e+" HTTP status: "+s),r.xhr=a,i&&i(r)):n(a.responseText),
f.onXhrComplete&&f.onXhrComplete(a,e))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,s="utf-8",r=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),s)),c="";try{for(n=new java.lang.StringBuffer,i=o.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=o.readLine());)n.append(a),n.append(i);c=String(n.toString())}finally{o.close()}t(c)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,a,o,c={};r&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(o,1,0,!1),a=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),a.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(n.available(),c),a.close(),n.close(),t(c.value)}catch(l){throw new Error((o&&o.path||"")+": "+l)}}),t}),define("text!templates/attachment.html",[],function(){return'<span>{{displayName}}</span><div class="new-message-attachments-action svg icon-delete"></div>'}),define("views/attachment",["require","handlebars","marionette","text!templates/attachment.html"],function(e){"use strict";var t=e("handlebars"),n=e("marionette"),i=e("text!templates/attachment.html");return n.ItemView.extend({tagName:"li",template:t.compile(i),events:{"click .icon-delete":"removeAttachment","click #mail-new-attachment-local":"addAttachmentLocal"},removeAttachment:function(){this.model.collection.remove(this.model)},addAttachmentLocal:function(){console.log("test")}})}),define("text!templates/attachments.html",[],function(){return'<ul></ul>\n<input type="button" id="mail_new_attachment" value="{{ t \'Add attachment from Files\' }}">'}),define("views/attachments",["require","marionette","OC","handlebars","views/attachment","text!templates/attachments.html"],function(e){"use strict";var n=e("marionette"),i=e("OC"),s=e("handlebars"),r=e("views/attachment"),a=e("text!templates/attachments.html");return n.CompositeView.extend({collection:null,childView:r,childViewContainer:"ul",template:s.compile(a),events:{"click #mail_new_attachment":"addAttachment"},initialize:function(e){this.collection=e.collection},addAttachment:function(){var e=this;i.dialogs.filepicker(t("mail","Choose a file to add as attachment"),function(t){e.collection.add([{fileName:t}])})}})}),define("text!templates/composer.html",[],function(){return'<div class="message-composer">\n	{{#unless isReply}}\n	<select class="mail-account">\n		{{#each aliases}}\n		<option value="{{accountId}}">{{ t \'from\' }} {{name}} &lt;{{emailAddress}}&gt;</option>\n		{{/each}}\n	</select>\n	{{/unless}}\n	<div class="composer-fields">\n		<a href="#" class="composer-cc-bcc-toggle transparency\n			{{#ifHasCC replyCc replyCcList}}\n			hidden\n			{{/ifHasCC}}">{{ t \'+ cc/bcc\' }}</a>\n		<input type="text" name="to"\n		    {{#if replyToList}}\n		    value="{{printAddressListPlain replyToList}}"\n		    {{else}}\n		    value="{{to}}"\n		    {{/if}}\n		    class="to recipient-autocomplete" />\n		<label class="to-label" for="to" class="transparency">{{ t \'to\' }}</label>\n		<div class="composer-cc-bcc\n		    {{#unlessHasCC replyCc replyCcList}}\n		    hidden\n		    {{/unlessHasCC}}">\n			<input type="text" name="cc"\n			    {{#if replyCc}}\n			    value="{{replyCc}}"\n			    {{else}}\n				{{#if replyCcList}}\n				value="{{printAddressListPlain replyCcList}}"\n				{{else}}\n				value="{{cc}}"\n				{{/if}}\n			    {{/if}}\n			    class="cc recipient-autocomplete" />\n			<label for="cc" class="cc-label transparency">{{ t \'cc\' }}</label>\n			<input type="text" name="bcc" value="{{bcc}}" class="bcc recipient-autocomplete" />\n			<label for="bcc" class="bcc-label transparency">{{ t \'bcc\' }}</label>\n		</div>\n		{{#unless isReply}}\n		<input type="text" name="subject" value="{{subject}}" class="subject"\n			placeholder="{{ t \'Subject\' }}" />\n		{{/unless}}\n		<textarea name="body" class="message-body\n					{{#if isReply}} reply{{/if}}"\n			placeholder="{{ t \'Message …\' }}">{{message}}</textarea>\n	</div>\n	<div class="submit-message-wrapper">\n		<input class="submit-message send primary" type="submit" value="{{submitButtonTitle}}" disabled>\n		<div class="submit-message-wrapper-inside" ></div>\n	</div>\n	<div class="new-message-attachments">\n	</div>\n</div>\n'}),define("views/composer",["require","marionette","handlebars","jquery","OC","radio","models/attachments","views/attachments","text!templates/composer.html"],function(e){"use strict";var n=e("marionette"),i=e("handlebars"),s=e("jquery"),r=e("OC"),a=e("radio"),o=e("models/attachments"),c=e("views/attachments"),l=e("text!templates/composer.html");return n.LayoutView.extend({template:i.compile(l),templateHelpers:function(){var e=null;return this.accounts&&(e=this.accounts.map(function(e){return e.toJSON()}),e=_.filter(e,function(e){return-1!==e.accountId})),{aliases:e,isReply:this.isReply(),to:this.data.to,cc:this.data.cc,subject:this.data.subject,message:this.data.body,submitButtonTitle:this.isReply()?t("mail","Reply"):t("mail","Send"),replyToList:this.data.replyToList,replyCc:this.data.replyCc,replyCcList:this.data.replyCcList}},type:"new",data:null,attachments:null,submitCallback:null,sentCallback:null,draftCallback:null,accounts:null,account:null,folderId:null,messageId:null,draftInterval:1500,draftTimer:null,draftUID:null,hasData:!1,autosized:!1,regions:{attachmentsRegion:".new-message-attachments"},events:{"click .submit-message":"submitMessage","click .submit-message-wrapper-inside":"submitMessageWrapperInside","keypress .message-body":"handleKeyPress","input  .to":"onInputChanged","paste  .to":"onInputChanged","keyup  .to":"onInputChanged","input  .cc":"onInputChanged","paste  .cc":"onInputChanged","keyup  .cc":"onInputChanged","input  .bcc":"onInputChanged","paste  .bcc":"onInputChanged","keyup  .bcc":"onInputChanged","input  .subject":"onInputChanged","paste  .subject":"onInputChanged","keyup  .subject":"onInputChanged","input  .message-body":"onInputChanged","paste  .message-body":"onInputChanged","keyup  .message-body":"onInputChanged","focus  .recipient-autocomplete":"onAutoComplete","click .composer-cc-bcc-toggle":"ccBccToggle"},initialize:function(e){var t={type:"new",onSubmit:function(){},onDraft:function(){},onSent:function(){},account:null,folderId:null,messageId:null,data:{to:"",cc:"",subject:"",body:""}};_.defaults(e,t),this.type=e.type,e.el&&(this.el=e.el),this.submitCallback=e.onSubmit,this.draftCallback=e.onDraft,this.sentCallback=e.onSent,this.attachments=new o,this.data=e.data,this.isReply()?(this.account=e.account,this.folderId=e.folderId,this.messageId=e.messageId):(this.accounts=e.accounts,this.account=e.account||this.accounts.at(0))},onRender:function(){if(this.attachmentsRegion.show(new c({collection:this.attachments})),s(".tipsy-mailto").tipsy({gravity:"n",live:!0}),this.isReply()){var e=this;this.$(".message-body").click(function(){e.setAutoSize(!0)})}else this.setAutoSize(!0)},setAutoSize:function(e){e===!0?(this.autosized||(this.$("textarea").autosize({append:"\n\n"}),this.autosized=!0),this.$(".message-body").trigger("autosize.resize")):(this.$(".message-body").trigger("autosize.destroy"),this.$(".message-body").css("height",""),this.autosized=!1)},isReply:function(){return"reply"===this.type},onInputChanged:function(){var e=this.$(".to").val(),t=this.$(".subject").val(),n=this.$(".message-body").val();""!==e||""!==t||""!==n?this.$(".submit-message").removeAttr("disabled"):this.$(".submit-message").attr("disabled",!0),this.hasData=!0,clearTimeout(this.draftTimer);var i=this;this.draftTimer=setTimeout(function(){i.saveDraft()},this.draftInterval)},handleKeyPress:function(e){e=e||window.event;var t=e.keyCode||e.which;if((13===t||10===t)&&e.ctrlKey){var n=this.$(".submit-message").attr("disabled");void 0===n&&this.submitMessage()}return!0},ccBccToggle:function(){this.$(".composer-cc-bcc").slideToggle(),this.$(".composer-cc-bcc .cc").focus(),this.$(".composer-cc-bcc-toggle").fadeOut()},getMessage:function(){var e={},t=this.$(".message-body"),n=this.$(".to"),i=this.$(".cc"),s=this.$(".bcc"),r=this.$(".subject");return e.body=t.val(),e.to=n.val(),e.cc=i.val(),e.bcc=s.val(),e.subject=r.val(),e.attachments=this.attachments.toJSON(),e},submitMessageWrapperInside:function(){this._isVisible()?this.$(".submit-message").click():(s("#mail-message").animate({scrollTop:this.$el.offset().top},1e3),this.$(".submit-message-wrapper-inside").hide(),this._setCaretToPos(this.$(".message-body")[0],0))},_setSelectionRange:function(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i.select()}},_setCaretToPos:function(e,t){this._setSelectionRange(e,t,t)},_isVisible:function(){var e=this.$el,t=s(window),n=t.scrollTop(),i=n+t.height(),r=e.offset().top;return i>=r},submitMessage:function(){clearTimeout(this.draftTimer);var e=this.$(".message-body"),n=this.$(".submit-message");e.addClass("icon-loading");var i=this.$(".to"),s=this.$(".cc"),o=this.$(".bcc"),c=this.$(".subject");this.$(".mail-account").prop("disabled",!0),i.prop("disabled",!0),s.prop("disabled",!0),o.prop("disabled",!0),c.prop("disabled",!0),this.$(".new-message-attachments-action").css("display","none"),this.$("#mail_new_attachment").prop("disabled",!0),e.prop("disabled",!0),n.prop("disabled",!0),n.val(t("mail","Sending …")),this.$(".mail-account").length>0&&(this.account=this.accounts.get(this.$(".mail-account").find(":selected").val()));var l=this,u={draftUID:this.draftUID,success:function(){r.Notification.showTemporary(t("mail","Message sent!")),null!==l.sentCallback?l.sentCallback():l.$(".message-composer").slideUp(),l.$("#mail_new_message").prop("disabled",!1),i.val(""),s.val(""),o.val(""),c.val(""),e.val(""),e.trigger("autosize.resize"),l.attachments.reset(),null!==l.draftUID&&(_.isUndefined(a.ui.request("messagesview:collection"))||a.ui.request("messagesview:collection").remove({id:l.draftUID}),l.draftUID=null)},error:function(e){var i="";if(500===e.status)i=t("mail","Server error");else{var s=JSON.parse(e.responseText);i=s.message}n.prop("disabled",!1),r.Notification.showTemporary(i)},complete:function(){e.removeClass("icon-loading"),l.$(".mail-account").prop("disabled",!1),i.prop("disabled",!1),s.prop("disabled",!1),o.prop("disabled",!1),c.prop("disabled",!1),l.$(".new-message-attachments-action").css("display","inline-block"),l.$("#mail_new_attachment").prop("disabled",!1),e.prop("disabled",!1),n.prop("disabled",!1),n.val(t("mail","Send"))}};return this.isReply()&&(u.messageId=this.messageId,u.folder=this.account.get("folders").get(this.folderId)),this.submitCallback(this.account,this.getMessage(),u),!1},saveDraft:function(e){clearTimeout(this.draftTimer),this.$(".mail-account").length>0&&(this.account=this.accounts.get(this.$(".mail-account").find(":selected").val()));var t=this;return this.draftCallback(this.account,this.getMessage(),{folder:this.account.get("folders").get(this.folderId),messageId:this.messageId,draftUID:this.draftUID,success:function(n){_.isFunction(e)&&e(),t.draftUID=n.uid},error:function(){}}),!1},setReplyBody:function(e,t,n){var i=t.getMinutes();this.$(".message-body").first().text("\n\n\n"+e+" – "+s.datepicker.formatDate("D, d. MM yy ",t)+t.getHours()+":"+(10>i?"0":"")+i+"\n> "+n.replace(/\n/g,"\n> ")),this.setAutoSize(!1);var r=this;this.$(".message-body").click(function(){r.setAutoSize(!0)})},focusTo:function(){this.$el.find("input.to").focus()},setTo:function(e){this.$el.find("input.to").val(e)},focusSubject:function(){this.$el.find("input.subject").focus()},onAutoComplete:function(e){function t(e){return e.split(/,\s*/)}function n(e){return t(e).pop()}var i=s(e.target);i.data("autocomplete")||i.bind("keydown",function(e){e.keyCode===s.ui.keyCode.TAB&&"undefined"!=typeof i.data("autocomplete")&&i.data("autocomplete").menu.active&&e.preventDefault()}).autocomplete({source:function(e,t){s.getJSON(r.generateUrl("/apps/mail/autoComplete"),{term:n(e.term)},t)},search:function(){var e=n(this.value);return e.length>=2},focus:function(){return!1},select:function(e,n){var i=t(this.value);return i.pop(),i.push(n.item.value),i.push(""),this.value=i.join(", "),!1}})}})}),define("util/htmlhelper",[],function(){"use strict";function e(e){var t="__break_token__";e=e.replace(/<br>/g,t),e=e.replace(/<br\/>/g,t),e=e.replace(/<\/div>/g,"</div>"+t),e=e.replace(/<\/p>/g,"</p>"+t),e=e.replace(/<\/li>/g,"</li>"+t);var n=$("<div>");n.html(e);var i=n.text();return i=i.replace(new RegExp(t,"g"),"\n")}return{htmlToText:e}}),define("text!templates/message.html",[],function(){return'<div id="mail-message-close" class="icon-close"></div>\n<div id="mail-message-header" class="section">\n	<h2 title="{{subject}}">{{subject}}</h2>\n	<p class="transparency">\n		{{printAddressList fromList}}\n		{{#if toList}}\n		{{ t \'to\' }}\n		{{printAddressList toList}}\n		{{/if}}\n		{{#if ccList}}\n		({{ t \'cc\' }} {{printAddressList ccList}})\n		{{/if}}\n	</p>\n</div>\n<div class="mail-message-body">\n	<div id="mail-content">\n		{{#if hasHtmlBody}}\n		<div id="show-images-text">\n			{{ t \'The images have been blocked to protect your privacy.\' }}\n			<button id="show-images-button">{{ t \'Show images from this sender\' }}</button>\n		</div>\n		<div class="icon-loading">\n			<iframe src="{{htmlBodyUrl}}" seamless>\n			</iframe>\n		</div>\n		{{else}}\n		{{{body}}}\n		{{/if}}\n	</div>\n	{{#if signature}}\n	<div class="mail-signature">\n		{{{signature}}}\n	</div>\n	{{/if}}\n\n	<div class="mail-message-attachments">\n		{{#if attachment}}\n		<ul>\n			<li class="mail-message-attachment mail-message-attachment-single" data-message-id="{{attachment.messageId}}" data-attachment-id="{{attachment.id}}" data-attachment-mime="{{attachment.mime}}">\n				{{#if attachment.isImage}}\n					<img class="mail-attached-image" src="{{attachment.downloadUrl}}">\n					<br>\n				{{/if}}\n				<img class="attachment-icon" src="{{attachment.mimeUrl}}" />\n				{{attachment.fileName}} <span class="attachment-size">({{humanFileSize attachment.size}})</span><br/>\n				<a class="button icon-download attachment-download" href="{{attachment.downloadUrl}}">{{ t \'Download attachment\' }}</a>\n				<button class="icon-folder attachment-save-to-cloud">{{ t \'Save to Files\' }}</button>\n			</li>\n		</ul>\n		{{/if}}\n		{{#if attachments}}\n		<ul>\n			{{#each attachments}}\n			<li class="mail-message-attachment {{#if isImage}}mail-message-attachment-image{{/if}}" data-message-id="{{messageId}}" data-attachment-id="{{id}}" data-attachment-mime="{{mime}}">\n				{{#if isImage}}\n					<img class="mail-attached-image" src="{{downloadUrl}}">\n					<br>\n				{{/if}}\n				<a class="button icon-download attachment-download" href="{{downloadUrl}}" title="{{ t \'Download attachment\' }}"></a>\n				<button class="icon-folder attachment-save-to-cloud" title="{{ t \'Save to Files\' }}"></button>\n				<img class="attachment-icon" src="{{mimeUrl}}" />\n				{{fileName}} <span class="attachment-size">({{humanFileSize size}})</span>\n			</li>\n			{{/each}}\n		</ul>\n		<p>\n			<button data-message-id="{{id}}" class="icon-folder attachments-save-to-cloud">{{ t \'Save all to Files\' }}</button>\n		</p>\n		{{/if}}\n	</div>\n	<div id="reply-composer"></div>\n	<input type="button" id="forward-button" value="{{ t \'Forward\' }}">\n</div>\n'}),define("models/folder",["require","backbone","models/foldercollection"],function(e){"use strict";var t=e("backbone"),n=t.Model.extend({defaults:{open:!1,folders:[]},initialize:function(){var t=e("models/foldercollection");this.set("folders",new t(this.get("folders")))},toggleOpen:function(){this.set({open:!this.get("open")})},toJSON:function(){var e=t.Model.prototype.toJSON.call(this);return e.folders&&e.folders.toJSON&&(e.folders=e.folders.toJSON()),e.id||(e.id=this.cid),e}});return n}),define("models/foldercollection",["require","backbone","models/folder"],function(e){"use strict";var t=e("backbone"),n=e("models/folder"),i=t.Collection.extend({model:n});return i}),define("models/account",["require","backbone","models/foldercollection","OC"],function(e){"use strict";var t=e("backbone"),n=e("models/foldercollection"),i=e("OC"),s=t.Model.extend({defaults:{folders:[]},idAttribute:"accountId",url:i.generateUrl("apps/mail/accounts"),initialize:function(){this.set("folders",new n(this.get("folders")))},toJSON:function(){var e=t.Model.prototype.toJSON.call(this);return e.folders&&e.folders.toJSON&&(e.folders=e.folders.toJSON()),e.id||(e.id=this.cid),e}});return s}),define("models/accountcollection",["require","backbone","models/account","OC"],function(e){"use strict";var t=e("backbone"),n=e("models/account"),i=e("OC"),s=t.Collection.extend({model:n,url:i.generateUrl("apps/mail/accounts"),comparator:function(e){return e.get("id")}});return s}),define("state",["require","radio","models/accountcollection"],function(e){"use strict";var t=e("radio"),n=e("models/accountcollection"),i={},s=new n,r=null,a=null,o=null,c=null,l="",u=null,h=null;return Object.defineProperties(i,{accounts:{get:function(){return s},set:function(e){s=e}},currentAccount:{get:function(){return r},set:function(e){r=e}},currentFolder:{get:function(){return a},set:function(e){var n=a;a=e,e!==n&&t.ui.trigger("folder:changed")}},currentMessageId:{get:function(){return o},set:function(e){o=e}},currentMessageSubject:{get:function(){return c},set:function(e){c=e}},currentMessageBody:{get:function(){return l},set:function(e){l=e}},messagesLoading:{get:function(){return u},set:function(e){u=e}},messageLoading:{get:function(){return h},set:function(e){h=e}}}),i}),define("cache",["require","underscore","jquery","models/account"],function(e){"use strict";function t(e){var t=e.map(function(e){return e.get("accountId")});u.each(d.get("messages"),function(e,n){var i=u.any(t,function(e){return e===parseInt(n)});i||d.remove("messages."+n)})}function n(e,t){var n=f.getFolderPath(e,t);return d.isSet(n)?d.get(n):null}function i(e,t,n){var i=f.getMessagePath(e,t,n);if(d.isSet(i)){var r=d.get(i);return s(e,t,r),r}return null}function s(e,t,i){var s=f.getMessagePath(e,t,i.id);i.timestamp=Date.now(),d.set(s,i);var r=h.map(n(e,t),function(e){return[e]});r.sort(function(e,t){return t.timestamp-e.timestamp});var a=r.slice(20,r.length);u.each(a,function(n){d.remove(f.getMessagePath(e,t,n.id))})}function r(e,t,n){u.each(n,function(n){s(e,t,n)})}function a(e,t,n){var s=i(e,t,n);s&&d.remove(f.getMessagePath(e,t,n));var r=o(e,t);if(r){var a=u.filter(r,function(e){return e.id!==n});c(e,t,a)}}function o(e,t){var n=m.getFolderPath(e,t);return d.isSet(n)?d.get(n):null}function c(e,t,n){var i=m.getFolderPath(e,t);d.set(i,n)}function l(e){var t=m.getAccountPath(e);d.isSet(t)&&d.remove(t),t=f.getAccountPath(e),d.isSet(t)&&d.remove(t),-1!==e.get("accountId")&&l(new p({accountId:-1}))}var u=e("underscore"),h=e("jquery"),d=h.localStorage,p=e("models/account"),f={getAccountPath:function(e){return["messages",e.get("accountId").toString()].join(".")},getFolderPath:function(e,t){return[this.getAccountPath(e),t.get("id").toString()].join(".")},getMessagePath:function(e,t,n){return[this.getFolderPath(e,t),n.toString()].join(".")}},m={getAccountPath:function(e){return["folders",e.get("accountId").toString()].join(".")},getFolderPath:function(e,t){return[this.getAccountPath(e),t.get("id").toString()].join(".")}};return{cleanUp:t,getMessage:i,addMessage:s,addMessages:r,removeMessage:a,getMessageList:o,addMessageList:c,removeAccount:l}}),define("communication",["require","underscore","jquery","OC","radio","cache","state","cache","cache","cache"],function(e){"use strict";function t(e,t){var n={ttl:6e4,cache:!0,key:e},i=t||{};if(o.defaults(i,n),i.cache=!1,i.cache){var s=c.initNamespaceStorage(i.key).localStorage,r=s.get("ttl");r&&r<Date.now()&&s.removeAll();var a=s.get("data");if(a)return void t.success(a)}return c.ajax(e,{data:{},type:"GET",error:function(e,n){t.error(n)},success:function(e){i.cache&&(s.set("data",e),"number"==typeof i.ttl&&s.set("ttl",Date.now()+i.ttl)),t.success(e)}})}function n(t,n,i,s){s=s||{};var r={onSuccess:function(){},onError:function(){},backgroundMode:!1};o.defaults(s,r);var a=e("cache").getMessage(t,n,i);if(a)return void s.onSuccess(a);var u=c.ajax(l.generateUrl("apps/mail/accounts/{accountId}/folders/{folderId}/messages/{messageId}",{accountId:t.get("accountId"),folderId:n.get("id"),messageId:i}),{data:{},type:"GET",success:s.onSuccess,error:s.onError});s.backgroundMode||(e("state").messageLoading=u)}function i(t,n,i,s){s=s||{};var r={onSuccess:function(){},onError:function(){}};o.defaults(s,r);var a=[],u=[];if(o.each(i,function(i){var s=e("cache").getMessage(t,n,i);s?a.push(s):u.push(i)}),u.length>0){var h=u.join(","),d=l.generateUrl("apps/mail/accounts/{accountId}/folders/{folderId}/messages?ids={ids}",{accountId:t.get("accountId"),folderId:n.get("id"),ids:h});c.ajax(d,{type:"GET",success:s.onSuccess,error:s.onError})}}function s(e,t,n){var i={success:function(){},error:function(){},complete:function(){},draftUID:null};o.defaults(n,i);var s=l.generateUrl("/apps/mail/accounts/{id}/send",{id:e.get("id")}),r={type:"POST",success:function(e){o.isNull(n.messageId)||u.ui.trigger("messagesview:messageflag:set",n.messageId,"answered",!0),n.success(e)},error:n.error,complete:n.complete,data:{to:t.to,cc:t.cc,bcc:t.bcc,subject:t.subject,body:t.body,attachments:t.attachments,folderId:n.folder?n.folder.get("id"):null,messageId:n.messageId,draftUID:n.draftUID}};c.ajax(s,r)}function r(e,t,n){function i(e){return void 0===e||""===e}var s={success:function(){},error:function(){},complete:function(){},folder:null,messageId:null,draftUID:null};o.defaults(n,s);var r=!0,a=["to","cc","bcc","subject","body"];if(o.each(a,function(e){i(t[e])||(r=!1)}),r){if(null!==n.draftUID){var h=e.get("specialFolders").drafts,d=l.generateUrl("apps/mail/accounts/{accountId}/folders/{folderId}/messages/{messageId}",{accountId:e.get("accountId"),folderId:h,messageId:n.draftUID});c.ajax(d,{type:"DELETE"})}n.success({uid:null})}else{var p=l.generateUrl("/apps/mail/accounts/{id}/draft",{id:e.get("accountId")}),f={type:"POST",success:function(e){if(null!==n.draftUID){var t=u.ui.request("messagesview:collection"),i=t.findWhere({id:n.draftUID});i&&(i.set({id:e.uid}),t.set([i],{remove:!1}))}n.success(e)},error:n.error,complete:n.complete,data:{to:t.to,cc:t.cc,bcc:t.bcc,subject:t.subject,body:t.body,attachments:t.attachments,folderId:n.folder?n.folder.get("id"):null,messageId:n.messageId,uid:n.draftUID}};c.ajax(p,f)}}function a(t,n,i){i=i||{};var s={cache:!1,replace:!1,force:!1,onSuccess:function(){},onError:function(){},onComplete:function(){}};if(o.defaults(i,s),null!==h&&h.abort(),i.cache){var r=e("cache").getMessageList(t,n);if(!i.force&&r)return i.onSuccess(r,!0),void i.onComplete()}var a=l.generateUrl("apps/mail/accounts/{accountId}/folders/{folderId}/messages",{accountId:t.get("accountId"),folderId:n.get("id")});h=c.ajax(a,{data:{from:i.from,to:i.to,filter:i.filter},success:function(s){(i.replace||i.cache)&&e("cache").addMessageList(t,n,s),i.onSuccess(s,!1)},error:function(e,t){"abort"!==t&&i.onError(e)},complete:i.onComplete})}var o=e("underscore"),c=e("jquery"),l=e("OC"),u=e("radio"),h=null;return{get:t,fetchMessage:n,fetchMessages:i,fetchMessageList:a,sendMessage:s,saveDraft:r}}),define("views/message",["require","marionette","handlebars","underscore","jquery","util/htmlhelper","views/composer","text!templates/message.html","state","state","state","state","communication","communication"],function(e){"use strict";var t=e("marionette"),n=e("handlebars"),i=e("underscore"),s=e("jquery"),r=e("util/htmlhelper"),a=e("views/composer"),o=e("text!templates/message.html");return t.LayoutView.extend({template:n.compile(o),className:"mail-message-container",message:null,reply:null,ui:{messageIframe:"iframe"},regions:{replyComposer:"#reply-composer"},initialize:function(t){if(this.message=t.model,this.reply={replyToList:this.message.get("replyToList"),replyCc:this.message.get("replyCc"),replyCcList:this.message.get("replyCcList"),body:""},!this.message.get("hasHtmlBody")){var n=new Date(this.message.get("dateIso")),i=n.getMinutes(),a=r.htmlToText(this.message.get("body"));this.reply.body="\n\n\n\n"+this.message.get("from")+" – "+s.datepicker.formatDate("D, d. MM yy ",n)+n.getHours()+":"+(10>i?"0":"")+i+"\n> "+a.replace(/\n/g,"\n> ")}this.message.get("hasHtmlBody")||(e("state").currentMessageBody=this.message.get("body")),e("state").currentMessageSubject=this.message.get("subject"),adjustControlsWidth(),this.message.get("hasHtmlBody")&&s("#forward-button").hide()},onIframeLoad:function(){this.ui.messageIframe.height(this.ui.messageIframe.contents().find("html").height()+20),this.ui.messageIframe.contents().find("body").css({margin:"0","font-weight":"normal","font-size":".8em","line-height":"1.6em","font-family":'"Open Sans", Frutiger, Calibri, "Myriad Pro", Myriad, sans-serif',color:"#000"}),this.ui.messageIframe.contents().find("font").prop({face:"Open Sans",color:"#000"}),this.ui.messageIframe.contents().find(".moz-text-flowed").css({"font-family":"inherit","font-size":"inherit"}),this.ui.messageIframe.height(this.ui.messageIframe.contents().find("html").height()+20),this.ui.messageIframe.contents().find("blockquote").css({color:"#888"}),this.ui.messageIframe.parent().removeClass("icon-loading");var t=!1;this.ui.messageIframe.contents().find("[data-original-src],[data-original-style]").length&&(t=!0),t?s("#show-images-text").show():s("#show-images-text").hide();var n=this.ui.messageIframe.contents().find("body").html();n=r.htmlToText(n);var i=new Date(this.message.get("dateIso"));this.replyComposer.currentView.setReplyBody(this.message.get("from"),i,n),e("state").currentMessageBody=n,this.$("#forward-button").show()},onShow:function(){this.ui.messageIframe.on("load",i.bind(this.onIframeLoad,this));var t=this;this.$(".mail-message-attachments img.mail-attached-image").each(function(){s(this).css({"max-width":t.$(".mail-message-body").width(),height:"auto"})});var n=e("state").accounts.get(this.message.get("accountId")),r=this.message.get("folderId");this.replyComposer.show(new a({type:"reply",onSubmit:e("communication").sendMessage,onDraft:e("communication").saveDraft,account:n,folderId:r,messageId:this.message.get("messageId"),data:this.reply}))}})}),define("models/messageflags",["require","backbone"],function(e){"use strict";var t=e("backbone"),n=t.Model.extend({defaults:{answered:!1}});return n}),define("models/message",["require","backbone","jquery","OC","radio","models/messageflags","state","state"],function(e){"use strict";var n=e("backbone"),i=e("jquery"),s=e("OC"),r=e("radio"),a=e("models/messageflags"),o=n.Model.extend({defaults:{flags:[],active:!1},initialize:function(){this.set("flags",new a(this.get("flags"))),this.listenTo(this.get("flags"),"change",this._transformEvent)},_transformEvent:function(){this.trigger("change"),this.trigger("change:flags",this)},toJSON:function(){var e=n.Model.prototype.toJSON.call(this);return e.flags&&e.flags.toJSON&&(e.flags=e.flags.toJSON()),e.id||(e.id=this.cid),e},flagMessage:function(n,a){var o=this.id,c=this;c.get("flags").set(n,a);var l=[n,a];i.ajax(s.generateUrl("apps/mail/accounts/{accountId}/folders/{folderId}/messages/{messageId}/flags",{accountId:e("state").currentAccount.get("accountId"),folderId:e("state").currentFolder.get("id"),messageId:o}),{data:{flags:_.object([l])},type:"PUT",success:function(){},error:function(){r.ui.trigger("error:show",t("mail","Message could not be starred. Please try again.")),c.get("flags").set(n,!a)}})}});return o}),define("models/messagecollection",["require","backbone","models/message"],function(e){"use strict";var t=e("backbone"),n=e("models/message"),i=t.Collection.extend({model:n,comparator:function(e){return-1*e.get("dateInt")}});return i}),define("text!templates/message-list-item.html",[],function(){return'<div class="mail-message-summary {{#if flags.unseen}}unseen{{/if}} {{#if active}}active{{/if}}" data-message-id="{{id}}">\n	{{#if accountMail}}\n	<div class="mail-message-account-color" style="background-color: {{accountColor accountMail}}"></div>\n	{{/if}}\n	<div class="mail-message-header">\n		<div class="sender-image avatardiv">\n			{{#if senderImage}}\n			<img src="{{senderImage}}" width="32px" height="32px" />\n			{{else}}\n			<div class="avatar" data-user="{{from}}" data-size="32"></div>\n			{{/if}}\n		</div>\n\n		{{#if flags.flagged}}\n		<div class="star icon-starred" data-starred="true"></div>\n		{{else}}\n		<div class="star icon-star" data-starred="false"></div>\n		{{/if}}\n\n		{{#if flags.answered}}\n		<div class="icon-reply"></div>\n		{{/if}}\n\n		{{#if flags.hasAttachments}}\n		<div class="icon-public icon-attachment"></div>\n		{{/if}}\n\n		<div class="mail-message-summary-from" title="{{fromEmail}}">{{from}}</div>\n		<div class="mail-message-summary-subject" title="{{subject}}">\n			{{subject}}\n		</div>\n		<div class="date">\n				<span class="modified"\n					title="{{formatDate dateInt}}">\n					{{relativeModifiedDate dateInt}}\n				</span>\n		</div>\n		<div class="icon-delete action delete" title="{{delete}}"></div>\n	</div>\n</div>\n'}),define("views/messagesitem",["require","jquery","handlebars","marionette","OC","radio","text!templates/message-list-item.html","state","state","state","state","state","state","state","cache","state"],function(e){"use strict";var n=e("jquery"),i=e("handlebars"),s=e("marionette"),r=e("OC"),a=e("radio"),o=e("text!templates/message-list-item.html");return s.ItemView.extend({template:i.compile(o),ui:{iconDelete:".action.delete",star:".star"},events:{"click .action.delete":"deleteMessage","click .mail-message-header":"openMessage","click .star":"toggleMessageStar"},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el);var e=this.model.get("from");e&&_.each(this.$el.find(".avatar"),function(t){n(t).height("32px"),n(t).imageplaceholder(e,e)}),n(".action.delete").tipsy({gravity:"e",live:!0})},toggleMessageStar:function(e){e.stopPropagation();var t=this.model.get("flags").get("flagged");t?this.ui.star.removeClass("icon-starred").addClass("icon-star"):this.ui.star.removeClass("icon-star").addClass("icon-starred"),this.model.flagMessage("flagged",!t)},openMessage:function(t){t.stopPropagation(),n("#mail-message").removeClass("hidden-mobile");var i=e("state").currentAccount,s=e("state").currentFolder,r=this.model.id;a.ui.trigger("message:load",i,s,r,{force:!0})},deleteMessage:function(i){i.stopPropagation();var s=this.model;this.ui.iconDelete.removeClass("icon-delete").addClass("icon-loading"),n(".tipsy").remove(),s.get("flags").set("unseen",!1),this.$el.addClass("transparency").slideUp(function(){n(".tipsy").remove(),n(".tooltip").remove();var t=s.collection,r=t.indexOf(s),o=t.at(r-1);if(o||(o=t.at(r+1)),t.remove(s),e("state").currentMessageId===s.id&&o){var c=e("state").currentAccount,l=e("state").currentFolder,u=o.id;a.ui.trigger("message:load",c,l,u)}i.clientX&&n(document.elementFromPoint(i.clientX,i.clientY)).trigger("mouseover")}),n.ajax(r.generateUrl("apps/mail/accounts/{accountId}/folders/{folderId}/messages/{messageId}",{accountId:e("state").currentAccount.get("accountId"),folderId:e("state").currentFolder.get("id"),messageId:s.id}),{data:{},type:"DELETE",success:function(){var t=e("cache"),n=e("state");t.removeMessage(n.currentAccount,n.currentFolder,s.id)},error:function(){a.ui.trigger("error:show",t("mail","Error while deleting message."))}})}})}),define("text!templates/message-list.html",[],function(){
return'<input type="button" id="load-new-mail-messages" value="{{ t \'Check messages\' }}">\n<div id="emptycontent" style="display: none;">\n	<div class="icon-mail"></div>\n	<h2>{{ t \'No messages in this folder!\' }}</h2>\n</div>\n<div id="mail-message-list"></div>\n<input type="button" id="load-more-mail-messages" value="{{ t \'Load more\' }}">'}),define("text!templates/no-search-results-message-list.html",[],function(){return'<div id="emptycontent" class="emptycontent-search">\n	<div class="icon-search"></div>\n	<h2>{{ t \'No search results for\' }} {{ searchTerm }}</h2>\n</div>'}),define("views/nosearchresultmessagelistview",["require","handlebars","marionette","text!templates/no-search-results-message-list.html"],function(e){"use strict";var t=e("handlebars"),n=e("marionette"),i=e("text!templates/no-search-results-message-list.html");return n.ItemView.extend({initialize:function(e){this.model.set("searchTerm",e.filterCriteria.text||"")},template:t.compile(i),onRender:function(){this.$("#load-more-mail-messages").hide()}})}),define("views/messages",["require","jquery","backbone","handlebars","radio","models/messagecollection","views/messagesitem","text!templates/message-list.html","views/nosearchresultmessagelistview","state","state","state","state","communication","state","state","state","state","state"],function(e){"use strict";var n=e("jquery"),i=e("backbone"),s=e("handlebars"),r=e("radio"),a=e("models/messagecollection"),o=e("views/messagesitem"),c=e("text!templates/message-list.html"),l=e("views/nosearchresultmessagelistview");return i.Marionette.CompositeView.extend({collection:null,childView:o,childViewContainer:"#mail-message-list",template:s.compile(c),currentMessageId:null,events:{"click #load-new-mail-messages":"loadNew","click #load-more-mail-messages":"loadMore"},filterCriteria:null,initialize:function(){this.collection=new a,this.collection.on("change:flags",this.changeFlags,this);var e=this;r.ui.reply("messagesview:collection",function(){return e.collection}),this.listenTo(r.ui,"messagesview:messages:update",this.loadNew),this.listenTo(r.ui,"messagesview:messages:reset",this.reset),this.listenTo(r.ui,"messagesview:messages:add",this.addMessages),this.listenTo(r.ui,"messagesview:messageflag:set",this.setMessageFlag),this.listenTo(r.ui,"messagesview:filter",this.filterCurrentMailbox),this.listenTo(r.ui,"messagesview:filter:clear",this.clearFilter),this.listenTo(r.ui,"messagesview:message:setactive",this.setActiveMessage)},getEmptyView:function(){return this.filterCriteria?l:void 0},emptyViewOptions:function(){return{filterCriteria:this.filterCriteria}},changeFlags:function(e){var t=e.get("flags").get("unseen"),n=e.get("flags")._previousAttributes.unseen;t!==n&&this.trigger("change:unseen",e,t)},setMessageFlag:function(e,t,n){var i=this.collection.get(e);i&&i.flagMessage(t,n)},setActiveMessage:function(t){var n=null;null!==this.currentMessageId&&(n=this.collection.get(this.currentMessageId),n&&n.set("active",!1)),this.currentMessageId=t,null!==t&&(n=this.collection.get(this.currentMessageId),n&&n.set("active",!0)),e("state").currentMessageId=t,e("state").folderView.updateTitle()},loadNew:function(){e("state").currentAccount&&e("state").currentFolder&&(n("#load-new-mail-messages").addClass("icon-loading-small").val(t("mail","Checking messages")).prop("disabled",!0),this.loadMessages(!0))},loadMore:function(){this.loadMessages(!1)},filterCurrentMailbox:function(e){this.filterCriteria={text:e},this.loadNew()},clearFilter:function(){n("#searchbox").val(""),this.filterCriteria=null},loadMessages:function(i){i=i||!1;var s=this.collection.size();i&&(s=0),n("#load-more-mail-messages").addClass("icon-loading-small").val(t("mail","Loading …")).prop("disabled",!0);var a=this;e("communication").fetchMessageList(e("state").currentAccount,e("state").currentFolder,{from:s,to:s+20,filter:this.filterCriteria?this.filterCriteria.text:null,force:!0,replace:i,onSuccess:function(t){i&&a.collection.reset(),a.collection.add(t),n("#app-content").removeClass("icon-loading"),r.ui.trigger("messagesview:message:setactive",e("state").currentMessageId)},onError:function(){r.ui.trigger("error:show",t("mail","Error while loading messages."));var n=e("state").currentAccount,i=e("state").currentFolder;r.folder.trigger("setactive",n,i)},onComplete:function(){n("#load-more-mail-messages").removeClass("icon-loading-small").val(t("mail","Load more …")).prop("disabled",!1),n("#load-new-mail-messages").removeClass("icon-loading-small").val(t("mail","Check messages")).prop("disabled",!1)}})},addMessages:function(e){this.collection.add(e)},reset:function(){this.collection.reset(),n("#messages-loading").fadeIn()}})}),define("text!templates/messagecontent.html",[],function(){return'<div id="mail-messages"></div>\n<div id="mail-message" class=" hidden-mobile"></div>'}),define("views/messagecontent",["require","jquery","underscore","backbone","marionette","handlebars","radio","views/composer","views/message","views/messages","text!templates/messagecontent.html","state","state","communication","communication","state","state","state"],function(e){"use strict";var n=e("jquery"),i=e("underscore"),s=e("backbone"),r=e("marionette"),a=e("handlebars"),o=e("radio"),c=e("views/composer"),l=e("views/message"),u=e("views/messages"),h=e("text!templates/messagecontent.html"),d=Object.freeze({MESSAGE:1,COMPOSER:2});return r.LayoutView.extend({template:a.compile(h),className:"container",detailView:null,composer:null,regions:{messages:"#mail-messages",message:"#mail-message"},initialize:function(){this.listenTo(o.ui,"message:show",this.onShowMessage),this.listenTo(o.ui,"composer:show",this.onShowComposer),this.listenTo(o.ui,"composer:leave",this.onComposerLeave),this.listenTo(o.ui,"composer:events:undelegate",function(){this.composer&&this.composer.undelegateEvents()})},onShow:function(){this.messages.show(new u)},onShowMessage:function(e){o.ui.trigger("composer:events:undelegate");var t=new s.Model(e);this.message.show(new l({model:t})),this.detailView=d.MESSAGE,o.ui.trigger("messagesview:messageflag:set",e.id,"unseen",!1)},onShowComposer:function(s){if(n(".tipsy").remove(),n("#mail_new_message").prop("disabled",!0),n("#mail-message").removeClass("hidden-mobile"),null!==e("state").messageLoading&&(e("state").messageLoading.abort(),n("iframe").parent().removeClass("icon-loading"),n("#mail-message").removeClass("icon-loading"),n("#mail_message").removeClass("icon-loading")),this.message.show(new c({onSubmit:e("communication").sendMessage,onDraft:e("communication").saveDraft,accounts:e("state").accounts,data:s})),this.detailView=d.COMPOSER,this.composer=this.message.currentView,s&&s.hasHtmlBody&&o.ui.trigger("error:show",t("mail","Opening HTML drafts is not supported yet.")),-1!==e("state").currentAccount.get("accountId")&&n(".mail-account").val(e("state").currentAccount.get("accountId")),this.composer.focusTo(),s&&!i.isUndefined(s.currentTarget)&&!i.isUndefined(n(s.currentTarget).data().email)){var r='"'+n(s.currentTarget).data().label+'" <'+n(s.currentTarget).data().email+">";this.composer.setTo(r),this.composer.focusSubject()}o.ui.trigger("messagesview:message:setactive",null)},onComposerLeave:function(){this.detailView===d.COMPOSER&&(this.detailView=null,this.composer&&this.composer.hasData===!0&&(this.composer.hasUnsavedChanges===!0?this.composer.saveDraft(function(){o.ui.trigger("notification:show",t("mail","Draft saved!"))}):o.ui.trigger("notification:show",t("mail","Draft saved!"))))}})}),define("text!templates/folder.html",[],function(){return'<li data-folder_id="{{id}}" data-no_select="{{noSelect}}"\n	class="\n	{{#if unseen}}unread{{/if}}\n	{{#if active}} active{{/if}}\n	{{#if specialRole}} special-{{specialRole}}{{/if}}\n	{{#if folders}} collapsible{{/if}}\n	{{#if open}} open{{/if}}\n	">\n	{{#if folders}}<button class="collapse"></button>{{/if}}\n	<a class="folder {{#if specialRole}} icon-{{specialRole}} svg{{/if}}">\n		{{name}}\n		{{#if unseen}}\n		<span class="utils">{{unseen}}</span>\n		{{/if}}\n	</a>\n	<ul>\n		{{#each folders}}\n		<li data-folder_id="{{id}}"\n			class="\n	{{#if unseen}}unread{{/if}}\n	{{#if specialRole}} special-{{specialRole}}{{/if}}\n	">\n			<a class="folder\n				{{#if specialRole}} icon-{{specialRole}} svg{{/if}}">\n				{{name}}\n				{{#if unseen}}\n				<span class="utils">{{unseen}}</span>\n				{{/if}}\n			</a>\n			{{/each}}\n	</ul>\n</li>'}),define("views/folder",["require","jquery","backbone","handlebars","radio","text!templates/folder.html","state"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),i=e("handlebars"),s=e("radio"),r=e("text!templates/folder.html");return n.Marionette.ItemView.extend({template:i.compile(r),events:{"click .collapse":"collapseFolder","click .folder":"loadFolder"},collapseFolder:function(e){e.preventDefault(),this.model.toggleOpen()},loadFolder:function(n){n.preventDefault();var i=e("state").accounts.get(this.model.get("accountId")),r=t(n.currentTarget).parent().data("folder_id"),a=null;a=r===this.model.get("id")?this.model:this.model.get("folders").get(r);var o=t(n.currentTarget).parent().data("no_select");s.ui.trigger("folder:show",i,a,o)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)}})}),define("text!templates/account.html",[],function(){return'{{#if email}}\n<div class="mail-account-color" style="background-color: {{accountColor email}}"></div>\n{{/if}}\n<h2 class="mail-account-email" title="{{email}}">{{email}}</h2>\n<ul id="mail_folders" class="mail_folders with-icon" data-account_id="{{id}}">\n</ul>'}),define("views/account",["require","backbone","handlebars","views/folder","text!templates/account.html"],function(e){"use strict";var t=e("backbone"),n=e("handlebars"),i=e("views/folder"),s=e("text!templates/account.html");return t.Marionette.CompositeView.extend({collection:null,model:null,template:n.compile(s),childView:i,childViewContainer:"#mail_folders",initialize:function(e){this.model=e.model,this.collection=this.model.get("folders")}})}),define("background",["require","underscore","jquery","OC","cache","radio","state","communication","cache"],function(e){"use strict";function i(e,t,n,i,s,r){if("undefined"!=typeof Notification){var a=null!==document.querySelector(":focus");if(!a){var o=new Notification(e,{body:t,tag:n,icon:i});o.onclick=function(){h.ui.trigger("folder:show",s,r,!1),window.focus()},setTimeout(function(){o.close()},5e3)}}}function s(e,s){if("granted"===Notification.permission&&s.messages.length>0){var r=o.map(s.messages,function(e){return e.from});r=o.uniq(r),r.length>2?(r=r.slice(0,2),r.push("…")):r=r.slice(0,2);var a="";if(1===s.messages.length){var c=o.map(s.messages,function(e){return e.subject});a=t("mail","{from}\n{subject}",{from:r.join(),subject:c.join()})}else a=n("mail","%n new message in {folderName} \nfrom {from}","%n new messages in {folderName} \nfrom {from}",s.messages.length,{folderName:s.name,from:r.join()});var u="not-"+s.accountId+"-"+s.name,h=l.filePath("mail","img","mail-notification.png"),p=d.accounts.get(s.accountId);i(e,a,u,h,p,s.id)}}function r(e){e.each(function(t){var n=t.get("folders"),i=l.generateUrl("apps/mail/accounts/{id}/folders/detectChanges",{id:t.get("accountId")});c.ajax(i,{data:JSON.stringify({folders:n.toJSON()}),contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",success:function(i){o.each(i,function(i){i.newUnReadCounter>0&&(h.notification.trigger("favicon:change",l.filePath("mail","img","favicon-notification.png")),(1===d.accounts.length||-1===t.get("accountId"))&&s(t.get("email"),i));var r=e.get(i.accountId),a=n.get(i.id);a.set("uidvalidity",i.uidvalidity),a.set("uidnext",i.uidnext),a.set("unseen",i.unseen),a.set("total",i.total),d.currentAccount===r&&d.currentFolder.get("id")===i.id&&h.ui.request("messagesview:collection").add(i.messages);var o=u.getMessageList(r,a);o&&(o=o.concat(i.messages),u.addMessageList(r,a,o)),d.folderView.updateTitle()})}})})}function a(){function t(){if(r.length>0){var t=r;r=[],e("communication").fetchMessages(n,i,t,{onSuccess:function(t){e("cache").addMessages(n,i,t)}})}}var n=null,i=null,s=3e3,r=[],a=null;return{start:function(){n=d.currentAccount,i=d.currentFolder,a=setInterval(t,s)},restart:function(){clearInterval(a),r.length=0,this.start()},push:function(e){r.push(e)}}}var o=e("underscore"),c=e("jquery"),l=e("OC"),u=e("cache"),h=e("radio"),d=e("state");return{messageFetcher:new a,checkForNotifications:r,showNotification:i,showMailNotification:s}}),define("views/navigation-accounts",["require","underscore","jquery","marionette","views/account","models/accountcollection","radio","state","state","state","state","state","state","background"],function(e){"use strict";var t=e("underscore"),n=e("jquery"),i=e("marionette"),s=e("views/account"),r=e("models/accountcollection"),a=e("radio");return i.CollectionView.extend({collection:null,childView:s,initialize:function(){this.collection=new r,this.listenTo(a.ui,"folder:changed",this.onFolderChanged),this.listenTo(a.folder,"setactive",this.setFolderActive)},changeUnseen:function(t,n){var i=e("state").currentFolder;n?i.set("unseen",i.get("unseen")+1):i.get("unseen")>0&&i.set("unseen",i.get("unseen")-1),this.updateTitle()},updateTitle:function(){var t="";if(-1!==e("state").currentAccount.get("accountId")){var n=e("state").currentAccount;t=" - "+n.get("email")}var i=e("state").currentFolder,s=i.unseen||i.get("unseen"),r=i.name||i.get("name");s>0?window.document.title=r+" ("+s+")"+t+" - Mail - "+oc_defaults.title:window.document.title=r+t+" - Mail - "+oc_defaults.title},setFolderActive:function(n,i){a.ui.trigger("messagesview:filter:clear"),e("state").accounts.each(function(n){var i=e("state").folderView.collection.get(n.get("accountId"));if(!t.isUndefined(i)){var s=i.get("folders");t.each(s.models,function(e){s.get(e).set("active",!1)})}}),i.set("active",!0)},onFolderChanged:function(){e("background").messageFetcher.restart(),n("#mail-message").addClass("hidden-mobile")}})}),define("text!templates/settings-account.html",[],function(){return'<span class="mail-account-name">{{ emailAddress }}</span>\n<span class="actions">\n	<a class="icon-delete delete action"\n	   title="{{ t \'Delete\' }}"></a>\n</span>'}),define("views/settings-account",["require","handlebars","marionette","jquery","OC","text!templates/settings-account.html","cache"],function(e){"use strict";var n=e("handlebars"),i=e("marionette"),s=e("jquery"),r=e("OC"),a=e("text!templates/settings-account.html");return i.ItemView.extend({tagName:"li",id:function(){return"mail-account-"+this.model.get("accountId")},template:n.compile(a),events:{"click .delete.action":"onDelete"},onDelete:function(n){n.stopPropagation(),this.$el.removeClass("icon-delete").addClass("icon-loading-small");var i=this.model;s.ajax(r.generateUrl("/apps/mail/accounts/{accountId}"),{data:{accountId:i.get("accountId")},type:"DELETE",success:function(){e("cache").removeAccount(i),window.location.reload()},error:function(){r.Notification.show(t("mail","Error while deleting account."))}})}})}),define("views/settings-accounts",["require","marionette","views/settings-account"],function(e){"use strict";var t=e("marionette"),n=e("views/settings-account");return t.CollectionView.extend({tagName:"ul",className:"mailaccount-list",childView:n,filter:function(e){return-1!==e.get("accountId")}})}),define("text!templates/settings.html",[],function(){return'<div id="mailsettings">\n	<ul id="settings-accounts" class="mailaccount-list">\n	</ul>\n	<input id="new_mail_account" type="submit" value="{{ t \'Add mail account\' }}" class="new-button">\n\n	<p class="app-settings-hint">\n		{{{ t \'Looking to encrypt your emails? Install the <a href="https://www.mailvelope.com/" target="_blank">Mailvelope browser extension</a>!\' }}}\n	</p>\n</div>'}),define("views/settings",["require","handlebars","marionette","radio","views/settings-accounts","text!templates/settings.html"],function(e){"use strict";var t=e("handlebars"),n=e("marionette"),i=e("radio"),s=e("views/settings-accounts"),r=e("text!templates/settings.html");return n.LayoutView.extend({accounts:null,template:t.compile(r),regions:{accountsList:"#settings-accounts"},events:{"click #new_mail_account":"addAccount"},initialize:function(e){this.accounts=e.accounts},onShow:function(){this.accountsList.show(new s({collection:this.accounts}))},addAccount:function(){i.account.trigger("add")}})}),define("text!templates/newmessage.html",[],function(){return'<input type="button"\n       id="mail_new_message"\n       class="icon-add"\n       value="{{ t \'New message\' }}"\n       style="display: none">'}),define("views/newmessage",["require","marionette","handlebars","radio","text!templates/newmessage.html"],function(e){"use strict";var t=e("marionette"),n=e("handlebars"),i=e("radio"),s=e("text!templates/newmessage.html");return t.LayoutView.extend({template:n.compile(s),accounts:null,ui:{input:"input"},events:{"click input":"onClick"},initialize:function(e){this.accounts=e.accounts,this.listenTo(e.accounts,"add",this.onAccountsChanged)},onAccountsChanged:function(){0===this.accounts.size?this.ui.input.hide():this.ui.input.show()},onClick:function(e){e.preventDefault(),i.ui.trigger("composer:show",e)}})}),define("views/navigation",["require","jquery","marionette","radio","views/newmessage","state"],function(e){"use strict";var t=e("jquery"),n=e("marionette"),i=e("radio"),s=e("views/newmessage");return n.LayoutView.extend({el:t("#app-navigation"),regions:{newMessage:"#mail-new-message-fixed",accounts:"#app-navigation-accounts",settings:"#app-settings-content"},initialize:function(e){this.bindUIElements(),this.newMessage.show(new s({accounts:e.accounts})),this.listenTo(i.ui,"navigation:show",this.show),this.listenTo(i.ui,"navigation:hide",this.hide)},render:function(){},show:function(){this.$el.show(),t("#app-navigation-toggle").css("background-image","")},hide:function(){0===e("state").accounts.length&&(this.$el.hide(),t("#app-navigation-toggle").css("background-image","none"))}})}),define("text!templates/setup.html",[],function(){return'<form method="post">\n	<div class="hidden-visually">\n		<!-- Hack for Safari and Chromium/Chrome which ignore autocomplete="off" -->\n		<input type="text" id="fake_user" name="fake_user"\n		       autocomplete="off" tabindex="-1">\n		<input type="password" id="fake_password" name="fake_password"\n		       autocomplete="off" tabindex="-1">\n	</div>\n	<fieldset>\n		<div id="emptycontent">\n			<div class="icon-mail"></div>\n			<h2>{{ t \'Connect your mail account\' }}</h2>\n		</div>\n		<p class="grouptop">\n			<input type="text"\n			       name="account-name"\n			       placeholder="{{ t \'Name\' }}"\n			       value=""\n			       autofocus />\n		</p>\n		<p class="groupmiddle">\n			<input type="email"\n			       name="mail-address"\n			       placeholder="{{ t \'Mail Address\' }}"\n			       value=""\n			       required />\n		</p>\n		<p class="groupbottom">\n			<input type="password"\n			       name="mail-password"\n			       placeholder="{{ t \'Password\' }}"\n			       value=""\n			       required />\n		</p>\n\n		<a class="toggle-manual-mode icon-caret-dark">{{ t \'Manual configuration\' }}</a>\n\n		<div class="manual-inputs">\n			<p class="grouptop">\n				<input type="text"\n				       name="imap-host"\n				       placeholder="{{ t \'IMAP Host\' }}"\n				       value="" />\n			</p>\n			<p class="groupmiddle" id="setup-imap-ssl">\n				<select id="setup-imap-ssl-mode"\n					name="imap-sslmode"\n					title="{{ t \'IMAP security\' }}">\n					<option value="none">{{ t \'None\' }}</option>\n					<option value="ssl">{{ t \'SSL/TLS\' }}</option>\n					<option value="tls">{{ t \'STARTTLS\' }}</option>\n				</select>\n			</p>\n			<p class="groupmiddle">\n				<input type="number"\n				       name="imap-port"\n				       placeholder="{{ t \'IMAP Port\' }}"\n				       value="143" />\n			</p>\n			<p class="groupmiddle">\n				<input type="text"\n				       name="imap-user"\n				       placeholder="{{ t \'IMAP User\' }}"\n				       value="" />\n			</p>\n			<p class="groupbottom">\n				<input type="password"\n				       name="imap-password"\n				       placeholder="{{ t \'IMAP Password\' }}"\n				       value=""\n				       required />\n			</p>\n			<p class="grouptop">\n				<input type="text"\n				       name="smtp-host"\n				       placeholder="{{ t \'SMTP Host\' }}"\n				       value="" />\n			</p>\n			<p class="groupmiddle" id="setup-smtp-ssl">\n				<select id="setup-smtp-ssl-mode"\n					name="mail-smtp-sslmode"\n					title="{{ t \'SMTP security\' }}">\n					<option value="none">{{ t \'None\' }}</option>\n					<option value="ssl">{{ t \'SSL/TLS\' }}</option>\n					<option value="tls">{{ t \'STARTTLS\' }}</option>\n				</select>\n			</p>\n			<p class="groupmiddle">\n				<input type="number"\n				       name="smtp-port"\n				       placeholder="{{ t \'SMTP Port\' }}"\n				       value="587" />\n			</p>\n			<p class="groupmiddle">\n				<input type="text"\n				       name="smtp-user"\n				       placeholder="{{ t \'SMTP User\' }}"\n				       value="" />\n			</p>\n			<p class="groupbottom">\n				<input type="password"\n				       name="smtp-password"\n				       placeholder="{{ t \'SMTP Password\' }}" value=""\n				       required />\n			</p>\n		</div>\n\n		<div id="connect-loading" class="icon-loading"></div>\n		<input type="submit"\n		       class="primary"\n		       value="{{ t \'Connect\' }}"/>\n	</fieldset>\n</form>'}),define("views/setup",["require","jquery","underscore","marionette","handlebars","radio","text!templates/setup.html"],function(e){"use strict";var n=e("jquery"),i=e("underscore"),s=e("marionette"),r=e("handlebars"),a=e("radio"),o=e("text!templates/setup.html");return s.ItemView.extend({template:r.compile(o),id:"setup",firstToggle:!0,displayName:"",email:"",manualMode:!1,loading:!1,ui:{form:"form",inputs:"input, select",toggleManualMode:".toggle-manual-mode",accountName:'input[name="account-name"]',mailAddress:'input[name="mail-address"]',mailPassword:'input[name="mail-password"]',manualInputs:".manual-inputs",imapHost:'input[name="imap-host"]',imapPort:'input[name="imap-port"]',imapSslMode:"#setup-imap-ssl-mode",imapUser:'input[name="imap-user"]',imapPassword:'input[name="imap-password"]',smtpHost:'input[name="smtp-host"]',smtpSslMode:"#setup-smtp-ssl-mode",smtpPort:'input[name="smtp-port"]',smtpUser:'input[name="smtp-user"]',smtpPassword:'input[name="smtp-password"]',submitButton:"input[type=submit]",iconLoading:"#connect-loading"},events:{"click @ui.submitButton":"onSubmit","submit @ui.form":"onSubmit","click @ui.toggleManualMode":"toggleManualMode","change @ui.imapSslMode":"onImapSslModeChange","change @ui.smtpSslMode":"onSmtpSslModeChange"},initialize:function(e){i.defaults(e,{displayName:"",email:""}),this.displayName=e.displayName,this.email=e.email},onShow:function(){this.ui.manualInputs.hide(),this.ui.iconLoading.hide(),this.ui.accountName.val(this.displayName),this.ui.mailAddress.val(this.email)},toggleManualMode:function(e){if(e.stopPropagation(),this.manualMode=!this.manualMode,this.ui.manualInputs.slideToggle(),this.ui.imapHost.focus(),this.manualMode){if(this.firstToggle){var t=this.ui.mailAddress.val(),n=this.ui.mailPassword.val();this.ui.imapUser.val(t),this.ui.imapPassword.val(n),this.ui.smtpUser.val(t),this.ui.smtpPassword.val(n),this.firstToggle=!1}var i=this;this.ui.mailPassword.slideToggle(function(){i.ui.mailAddress.parent().removeClass("groupmiddle").addClass("groupbottom"),i.ui.imapHost.focus()})}else this.ui.mailPassword.slideToggle(),this.ui.mailAddress.parent().removeClass("groupbottom").addClass("groupmiddle")},onSubmit:function(e){e.preventDefault(),e.stopPropagation(),this.ui.inputs.prop("disabled",!0),this.ui.submitButton.val(t("mail","Connecting")),this.ui.iconLoading.fadeIn();var i=this.ui.mailAddress.val(),s=this.ui.accountName.val(),r=this.ui.mailPassword.val(),o={accountName:s,emailAddress:i,password:r,autoDetect:!0};this.manualMode&&(o={accountName:s,emailAddress:i,password:r,imapHost:this.ui.imapHost.val(),imapPort:this.ui.imapPort.val(),imapSslMode:this.ui.imapSslMode.val(),imapUser:this.ui.imapUser.val(),imapPassword:this.ui.imapPassword.val(),smtpHost:this.ui.smtpHost.val(),smtpPort:this.ui.smtpPort.val(),smtpSslMode:this.ui.smtpSslMode.val(),smtpUser:this.ui.smtpUser.val(),smtpPassword:this.ui.smtpPassword.val(),autoDetect:!1}),this.loading=!0;var c=a.account.request("create",o);n.when(c).done(function(){a.ui.trigger("navigation:show"),a.account.trigger("load")}),n.when(c).fail(function(e){a.ui.trigger("error:show",e)});var l=this;n.when(c).always(function(){l.loading=!1,l.ui.iconLoading.hide(),l.ui.inputs.prop("disabled",!1),l.ui.submitButton.val(t("mail","Connect"))})},onImapSslModeChange:function(){var e=143,t=993;switch(this.ui.imapSslMode.val()){case"none":case"tls":this.ui.imapPort.val(e);break;case"ssl":this.ui.imapPort.val(t)}},onSmtpSslModeChange:function(){var e=587,t=465;switch(this.ui.smtpSslMode.val()){case"none":case"tls":this.ui.smtpPort.val(e);break;case"ssl":this.ui.smtpPort.val(t)}}})}),define("views/app",["require","marionette","jquery","OC","radio","views/messagecontent","views/navigation-accounts","views/settings","views/navigation","views/setup","state","state","state","state"],function(e){"use strict";var t=e("marionette"),n=e("jquery"),i=e("OC"),s=e("radio"),r=e("views/messagecontent"),a=e("views/navigation-accounts"),o=e("views/settings"),c=e("views/navigation"),l=e("views/setup"),u=Object.freeze({MESSAGE_CONTENT:0,SETUP:1}),h=t.LayoutView.extend({el:n("#app"),accountsView:null,activeContent:null,regions:{navigation:"#app-navigation",content:"#app-content",setup:"#setup"},initialize:function(){this.bindUIElements(),this.listenTo(s.notification,"favicon:change",this.changeFavicon),this.listenTo(s.ui,"notification:show",this.showNotification),this.listenTo(s.ui,"error:show",this.showError),this.listenTo(s.ui,"setup:show",this.showSetup),this.listenTo(s.ui,"messagecontent:show",this.showMessageContent),n(document).on("show",this.onDocumentShow),n(document).keyup(this.onKeyUp),window.addEventListener("resize",this.onWindowResize),this.navigation=new c({accounts:e("state").accounts}),this.navigation.settings.show(new o({accounts:e("state").accounts})),this.accountsView=new a,e("state").folderView=this.accountsView,this.navigation.accounts.show(this.accountsView),this.showMessageContent()},onDocumentShow:function(e){e.preventDefault(),s.notification.trigger("favicon:change",i.filePath("mail","img","favicon.png"))},onKeyUp:function(t){t=t||window.e;var i=t.keyCode||t.which;e("state").currentMessageId&&46===i&&(n(".to, .cc, .message-body").is(":focus")||!n("#mail-messages").is(":visible")||n("#searchbox").is(":focus")||n(".mail-message-summary.active .icon-delete.action.delete").click())},onWindowResize:function(){var e=n("#mail-content iframe");e.height(e.contents().find("html").height()+20),n(".mail-message-attachments .mail-attached-image").each(function(){n(this).css("max-width",n(".mail-message-body").width())})},render:function(){},changeFavicon:function(e){n('link[rel="shortcut icon"]').attr("href",e)},showNotification:function(e){i.Notification.showTemporary(e)},showError:function(e){i.Notification.showTemporary(e),n("#app-navigation").removeClass("icon-loading"),n("#app-content").removeClass("icon-loading"),n("#mail-message").removeClass("icon-loading"),n("#mail_message").removeClass("icon-loading")},showSetup:function(){this.activeContent!==u.SETUP&&(this.activeContent=u.SETUP,this.content.show(new l({displayName:n("#user-displayname").text(),email:n("#user-email").text()})))},showMessageContent:function(){if(this.activeContent!==u.MESSAGE_CONTENT){this.activeContent=u.MESSAGE_CONTENT;var e=new r,t=this.accountsView;this.accountsView.listenTo(e.messages,"change:unseen",t.changeUnseen),this.content.show(e)}}});return h}),define("controller/accountcontroller",["require","jquery","radio","background"],function(e){"use strict";function n(){a.ui.trigger("composer:leave"),a.ui.trigger("navigation:hide"),a.ui.trigger("setup:show")}function i(t){setInterval(function(t){e("background").checkForNotifications(t)}(t),o)}function s(){var e=a.account.request("entities");r.when(e).done(function(e){if(0===e.length)n();else{var t=e.at(0);e.each(function(e){a.folder.trigger("init",e,t)})}i(e)}),r.when(e).fail(function(){a.ui.trigger("error:show",t("mail","Error while loading the accounts."))})}var r=e("jquery"),a=e("radio"),o=3e5;return a.account.on("add",n),a.account.on("load",s),{loadAccounts:s}}),define("service/folderservice",["require","jquery","OC","state"],function(e){"use strict";function t(t){var s=n.Deferred(),r=i.generateUrl("apps/mail/accounts/{id}/folders",{id:t.get("accountId")}),a=n.get(r);return a.done(function(n){for(var i in n)"folders"===i?(t.get("folders").reset(),t.get("folders").add(n.folders)):t.set(i,n[i]);e("state").folderView.collection.add(t),s.resolve(t.get("folders"))}),a.fail(function(){s.reject()}),s.promise()}var n=e("jquery"),i=e("OC");return{getFolderEntities:t}}),define("controller/foldercontroller",["require","jquery","underscore","radio","service/folderservice","state","state","background"],function(e){"use strict";function n(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))}function i(){var e=window.location.hash;if(""!==e&&"#"!==e){e=e.substr(1);var t={},i=e.split("&");a.each(i,function(e){e=e.split("=");var i=e[0],s=n(e[1]);switch(i){case"mailto":case"to":t.to=s;break;case"cc":t.cc=s;break;case"bcc":t.bcc=s;break;case"subject":t.subject=s;break;case"body":t.body=s}}),window.location.hash="",o.ui.trigger("composer:show",t)}}function s(n,s){var a=c.getFolderEntities(n);r("#mail-messages").addClass("icon-loading"),r("#mail-message").addClass("icon-loading"),o.ui.trigger("messagesview:messages:reset"),r("#app-navigation").addClass("icon-loading"),r.when(a).done(function(t){if(r("#app-navigation").removeClass("icon-loading"),n===s){var a=t.at(0);o.ui.trigger("folder:show",n,a,!1),i(),o.folder.trigger("setactive",n,a),e("state").currentAccount=n,e("state").currentFolder=a,e("background").messageFetcher.start()}}),r.when(a).fail(function(){o.ui.trigger("error:show",t("mail","Error while loading the selected account."))})}var r=e("jquery"),a=e("underscore"),o=e("radio"),c=e("service/folderservice");return o.folder.on("init",s),{loadFolder:s}}),define("service/accountservice",["require","jquery","OC","radio","state","cache"],function(e){"use strict";function n(e){var n=s.Deferred();return s.ajax(r.generateUrl("apps/mail/accounts"),{data:e,type:"POST",success:function(){n.resolve()},error:function(e,i,s){switch(e.status){case 400:var r=JSON.parse(e.responseText);n.reject(r.message);break;default:var a=s||i||t("mail","Unknown error");n.reject(t("mail","Error while creating an account: "+a))}}}),n.promise()}function i(){var t=s.Deferred();return e("state").accounts.fetch({success:function(n){e("cache").cleanUp(n),t.resolve(n)},error:function(){t.reject()}}),t.promise()}var s=e("jquery"),r=e("OC"),a=e("radio");return a.account.reply("create",n),a.account.reply("entities",i),{createAccount:n,getAccountEntities:i}}),define("notification",["require","underscore"],function(e){var t=e("underscore");t.isUndefined(OC.Notification.showTemporary)&&(OC.Notification.showTemporary=function(e,n){var i={isHTML:!1,timeout:7};n=n||{},t.defaults(n,i),OC.Notification.hide(),OC.Notification.notificationTimer&&clearTimeout(OC.Notification.notificationTimer),n.isHTML?OC.Notification.showHtml(e):OC.Notification.show(e),n.timeout>0&&(OC.Notification.notificationTimer=setTimeout(OC.Notification.hide,1e3*n.timeout))})}),define("app",["require","marionette","views/app","radio","controller/accountcontroller","controller/foldercontroller","service/accountservice","service/folderservice","notification"],function(e){"use strict";var t=e("marionette"),n=e("views/app"),i=e("radio");e("controller/accountcontroller"),e("controller/foldercontroller"),e("service/accountservice"),e("service/folderservice"),e("notification");
var s=new t.Application;return s.on("start",function(){i.account.trigger("load")}),s.view=new n,s}),define("search",["require","radio"],function(e){"use strict";function t(e){window.clearTimeout(i),i=window.setTimeout(function(){n.ui.trigger("messagesview:filter",e)},500),$("#searchresults").hide()}var n=e("radio"),i=null;return{filter:t}}),define("views/helper",["require","handlebars","state"],function(e){"use strict";var n=e("handlebars");n.registerHelper("relativeModifiedDate",function(e){var t=new Date(1e3*e),n=Math.round(t.getTime()/1e3);return relative_modified_date(n)}),n.registerHelper("formatDate",function(e){var t=new Date(1e3*e);return formatDate(t)}),n.registerHelper("humanFileSize",function(e){return humanFileSize(e)}),n.registerHelper("accountColor",function(e){var t=md5(e),i=parseInt("ffffffffffffffffffffffffffffffff",16),s=parseInt(t,16)/i*256;return new n.SafeString("hsl("+s+", 90%, 65%)")}),n.registerHelper("printAddressList",function(i){var s=e("state").currentAccount,r=_.reduce(i,function(e,i,r){0!==r&&(e+=", ");var a=i.label.replace(/(^"|"$)/g,"").replace(/(^'|'$)/g,"");a=n.Utils.escapeExpression(a);var o=n.Utils.escapeExpression(i.email);s&&o===s.get("emailAddress")&&(a=t("mail","you"));var c=t("mail","Send message to {email}",{email:o});return e+='<span class="tipsy-mailto" title="'+c+'">',e+='<a class="link-mailto" data-email="'+o+'" data-label="'+a+'">',e+=a+"</a></span>"},"");return new n.SafeString(r)}),n.registerHelper("printAddressListPlain",function(e){var t=_.reduce(e,function(e,t,i){0!==i&&(e+=", ");var s=t.label.replace(/(^"|"$)/g,"").replace(/(^'|'$)/g,"");s=n.Utils.escapeExpression(s);var r=n.Utils.escapeExpression(t.email);return s===r?e+r:e+'"'+s+'" <'+r+">"},"");return t}),n.registerHelper("ifHasCC",function(e,t,n){return!_.isUndefined(e)||!_.isUndefined(t)&&t.length>0?n.fn(this):n.inverse(this)}),n.registerHelper("unlessHasCC",function(e,t,n){return _.isUndefined(e)&&(_.isUndefined(t)||0===t.length)?n.fn(this):n.inverse(this)}),n.registerHelper("t",function(e){return t("mail",e)}),window.getScrollBarWidth=window.getScrollBarWidth||function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var i=e.offsetWidth;return n===i&&(i=t.clientWidth),document.body.removeChild(t),n-i},window.adjustControlsWidth=function(){if($("#mail-message-header").length){var e;$(window).width()>768&&(e=$("#content").width()-$("#app-navigation").width()-$("#mail-messages").width()-getScrollBarWidth()),$("#mail-message-header").css("width",e),$("#mail-message-header").css("min-width",e)}},$(window).resize(_.debounce(window.adjustControlsWidth,250))}),define("ui",["require","underscore","jquery","OC","radio","views/helper","state","state","state","state","state","state","state","communication","state","state","state","background","state","state","state","state","state","state","state","state","state","state","state","state","state","state","communication","state","state","cache","state","state"],function(e){"use strict";function n(n,i,s){l.ui.trigger("composer:leave"),l.ui.trigger("messagecontent:show"),null!==e("state").messagesLoading&&e("state").messagesLoading.abort(),null!==e("state").messageLoading&&e("state").messageLoading.abort(),l.folder.trigger("setactive",n,i),l.ui.trigger("messagesview:messages:reset"),o("#mail-messages").addClass("icon-loading"),o("#load-new-mail-messages").hide(),o("#load-more-mail-messages").hide(),s?(o("#emptycontent").show(),o("#mail-message").removeClass("icon-loading"),e("state").currentAccount=n,e("state").currentFolder=i,l.ui.trigger("messagesview:message:setactive",null),o("#mail-messages").removeClass("icon-loading"),e("state").currentlyLoading=null):e("communication").fetchMessageList(n,i,{onSuccess:function(t,s){if(e("state").currentlyLoading=null,e("state").currentAccount=n,e("state").currentFolder=i,l.ui.trigger("messagesview:message:setactive",null),o("#mail-messages").removeClass("icon-loading"),o("#mail_new_message").prop("disabled",!1),t.length>0){l.ui.trigger("messagesview:messages:add",t),a.each(t.slice(0,10),function(t){e("background").messageFetcher.push(t.id)});var c=t[0].id;r(n,c),t.length>20&&o("#load-more-mail-messages").fadeIn().css("display","block")}else o("#emptycontent").show(),o("#mail-message").removeClass("icon-loading");o("#load-new-mail-messages").fadeIn().css("display","block").prop("disabled",!1),s&&l.ui.trigger("messagesview:messages:update")},onError:function(i,s){if("abort"!==s){var r=e("state").currentFolder;l.folder.trigger("setactive",n,r),l.ui.trigger("error:show",t("mail","Error while loading messages."))}},cache:!0})}function i(n,i){c.dialogs.filepicker(t("mail","Choose a folder to store the attachment in"),function(s){var r=".attachment-save-to-cloud";"undefined"!=typeof i&&(r='li[data-attachment-id="'+i+'"] '+r),o(r).removeClass("icon-folder").addClass("icon-loading-small").prop("disabled",!0),o.ajax(c.generateUrl("apps/mail/accounts/{accountId}/folders/{folderId}/messages/{messageId}/attachment/{attachmentId}",{accountId:e("state").currentAccount.get("accountId"),folderId:e("state").currentFolder.get("id"),messageId:n,attachmentId:i}),{data:{targetPath:s},type:"POST",success:function(){"undefined"==typeof i?l.ui.trigger("error:show",t("mail","Attachments saved to Files.")):l.ui.trigger("error:show",t("mail","Attachment saved to Files."))},error:function(){"undefined"==typeof i?l.ui.trigger("error:show",t("mail","Error while saving attachments to Files.")):l.ui.trigger("error:show",t("mail","Error while saving attachment to Files."))},complete:function(){o(".attachment-save-to-cloud").removeClass("icon-loading-small").addClass("icon-folder").prop("disabled",!1)}})},!1,"httpd/unix-directory",!0)}function s(){var n="\n\n\n\n-------- "+t("mail","Forwarded message")+" --------\n",i={subject:"Fwd: "+e("state").currentMessageSubject,body:n+e("state").currentMessageBody.replace(/<br \/>/g,"\n")};-1!==e("state").currentAccount.get("accountId")&&(i.accountId=e("state").currentAccount.get("accountId")),l.ui.trigger("composer:show",i)}function r(n,i,s){s=s||{};var r={force:!1};if(a.defaults(s,r),e("state").currentMessageId!==i&&(l.ui.trigger("composer:leave"),s.force||!u)){null!==e("state").messageLoading&&e("state").messageLoading.abort();var c=n.get("specialFolders").drafts,h=c===e("state").currentFolder.get("id");if(null!==e("state").currentMessageId){var d=e("state").currentMessageId;if(l.ui.trigger("messagesview:message:setactive",null),d===i)return}l.ui.trigger("message:loading"),l.ui.trigger("messagesview:message:setactive",i),e("state").currentMessageBody="",o("#mail_new_message").prop("disabled",!1),e("communication").fetchMessage(e("state").currentAccount,e("state").currentFolder,i,{onSuccess:function(t){h?l.ui.trigger("composer:show",t):(e("cache").addMessage(e("state").currentAccount,e("state").currentFolder,t),l.ui.trigger("message:show",t))},onError:function(e,n){"abort"!==n&&l.ui.trigger("error:show",t("mail","Error while loading the selected message."))}})}}var a=e("underscore"),o=e("jquery"),c=e("OC"),l=e("radio");e("views/helper"),l.ui.on("folder:show",n),l.ui.on("message:load",function(e,t,n,i){r(e,n,i)});var u=!1;return{saveAttachment:i,openForwardComposer:s,loadMessage:r}}),define("init",["require","domready","OC","marionette","handlebars","radio","app","search","ui","ui","ui"],function(e){"use strict";function t(){o.TemplateCache.prototype.compileTemplate=function(e){return c.compile(e)},o.ItemView.prototype.modelEvents={change:"render"},o.CompositeView.prototype.modelEvents={change:"render"}}function n(){if(window.navigator.registerProtocolHandler){var e=window.location.protocol+"//"+window.location.host+a.generateUrl("apps/mail/compose?uri=%s");try{window.navigator.registerProtocolHandler("mailto",e,"ownCloud Mail")}catch(t){}}}function i(){"undefined"!=typeof Notification&&Notification.requestPermission()}function s(){SearchProxy.setFilter(e("search").filter)}var r=e("domready"),a=e("OC"),o=e("marionette"),c=e("handlebars"),l=e("radio"),u=e("app");t(),n(),i(),s(),u.start(),setInterval(function(){return function(){var e=$(".message-body");if(e.val()){var t=e.val(),n=e.val();n!==t&&(e.trigger("autosize.resize"),t=n)}}}(),1e3),$(r).on("click","#forward-button",function(){e("ui").openForwardComposer()}),$(r).on("click","#mail-message .attachment-save-to-cloud",function(t){t.stopPropagation();var n=$(this).parent().data("messageId"),i=$(this).parent().data("attachmentId");e("ui").saveAttachment(n,i)}),$(r).on("click","#mail-message .attachments-save-to-cloud",function(t){t.stopPropagation();var n=$(this).data("messageId");e("ui").saveAttachment(n)}),$(r).on("click",".link-mailto",function(e){l.ui.trigger("composer:show",e)}),$(r).on("click","#mail-message-close",function(){$("#mail-message").addClass("hidden-mobile")}),$(r).on("click","#show-images-button",function(){$("#show-images-text").hide(),$("iframe").contents().find("img[data-original-src]").each(function(){$(this).attr("src",$(this).attr("data-original-src")),$(this).show()}),$("iframe").contents().find("[data-original-style]").each(function(){$(this).attr("style",$(this).attr("data-original-style"))})})}),require(["app","init","notification"]);